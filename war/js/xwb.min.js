Xwb.Tpl={Box:'<div class="win-pop {.cs}"><div class="win-t"><div></div></div><div class="win-con"><div class="win-con-in">[?.title?{BoxTitlebar}?]<div class="win-box" id="xwb_dlg_ct">{.contentHtml}</div></div><div class="win-con-bg"></div></div><div class="win-b"><div></div></div>[?.closeable?<a href="#" class="icon-close-btn icon-bg" id="xwb_cls" title="关闭"></a>?]{.boxOutterHtml}</div>',DialogContent:'{.dlgContentHtml}<div class="btn-area" id="xwb_dlg_btns">{.buttonHtml}</div>',BoxTitlebar:'<h4 class="win-tit x-bg"><span id="xwb_title">{.title}</span></h4>',
Mask:'<div class="shade-div"></div>',ForwardDlgContentHtml:'<p id="xwb_forward_text"></p><div class="forward-tool"><span id="xwb_warn_tip">还可以输入140字</span><a href="#" class="icon-face-choose all-bg" id="xwb_face_trig"></a></div><textarea id="xwb_fw_input"></textarea><div id="xwb_fw_lbl"></div>',ForwardDlgLabel:'<label><input type="checkbox" value="{.uid}">同时作为{.nick}的评论发布</label>',MsgDlgContent:'<div class="tips-c"><div class="icon-alert all-bg" id="xwb_msgdlg_icon"></div><p id="xwb_msgdlg_ct"></p></div>',
Button:'<a href="#" class="general-btn {.cs}" id="xwb_btn_{.id}"><span>{.title}</span></a>',EmotionHotList:'<div class="hot-e-list" id="hotEm">{.hotList}</div>',EmotionBoxContent:'<div class="win-tab bottom-line" id="cate">\t{.category} </div><div class="emotion-box" id="box">{EmotionHotList}<div class="e-list" id="flist0">{.faces}</div></div>',ArrowBoxBottom:'<div class="arrow all-bg"></div>',EmotionIcon:'<a href="javascript:;" title="{.title}" rel="e:em"><img src="{.src}"></a>',Loading:'<div id="xweibo_loading" class="loading"></div>',
CommentArea:'<div class="feed-comment box-style hidden"><div class="box-t skin-bg"><span class="skin-bg"></span></div><div class="box-content">{.cmtBoxHtml}<ul id="cmtCt" class="hidden"></ul><div class="more-comment" id="more">后面还有<span id="lefCnt"></span>条评论，<a href="{.cmtUrl}">点击查看</a></div></div><div class="box-b skin-bg"><span class="skin-bg"></span></div><span class="box-arrow skin-bg"></span></div>',CmtBox:'<div class="post-comment" id="cmtBox"><div class="post-comment-main"><a href="javascript:;" class="icon-face-choose all-bg" rel="e:ic"></a><a class="general-btn" href="javascript:;" rel="e:sd"><span>评论</span></a><div class="comment-keyin"><div><textarea class="comment-textarea" id="inputor"></textarea></div></div></div><div><span class="keyin-tips" id="warn">还可以输入140个字</span><label><input type="checkbox" id="sync"/>同时发一条微博</label></div></div>',
MBCmtBox:'<div class="feed-comment box-style" id="cmtBox"><div class="box-t skin-bg"><span class="skin-bg"></span></div><div class="box-content"><div class="post-comment"><div class="post-comment-main"><a class="icon-face-choose all-bg" href="#" rel="e:ic"></a><a href="javascript:;" class="general-btn" rel="e:sd"><span>评论</span></a><div class="comment-keyin"><div><textarea id="inputor" class="comment-textarea"></textarea></div></div></div><div><!--当超过140个字时，class="keyin-tips over-limit"--\><span class="keyin-tips" id="warn">还可以输入140个字</span><label><input type="checkbox" id="sync">同时发一条微博</label></div></div></div><div class="box-b skin-bg"><span class="skin-bg"></span></div><span class="box-arrow skin-bg"></span></div>',
Comment:'<li rel="c:{.id},n:{.nick}"><div class="user-pic"><a href="{.usrUrl}"><img src="{.profileImg}" title="{.nick}" alt="{.nick}的头像" width="{.picSz}" height="{.picSz}" /></a></div><div class="comment-content"><p><a href="{.usrUrl}">{.nick}{.verifiedHtml}</a>：{.text}<span>({.time})</span></p><div>[?.canDel?<a href="javascript:;" rel="e:dl">删除</a>|?]<a href="javascript:;" rel="e:rp">回复</a></div></div></li>',MBlogCmt:'<li rel="c:{.id},n:{.nick}"><div class="user-pic"><a href="{.usrUrl}"><img alt="" src="{.profileImg}" /></a></div><div class="comment-c"><p class="c-info"><a href="{.usrUrl}">{.nick}{.verifiedHtml}</a> {.text}({.time}) </p><div class="c-for" id="trigs"><a href="javascript:;" class="icon-reply icon-bg" rel="e:rp">回复</a></div>{.cmtBoxHtml}[?.canDel?<a href="javascript:;" class="icon-del icon-bg" rel="e:dl">删除</a>?]</div></li>',
Followed:'<span class="followed-icon {.cs}">已关注</span>',MediaBoxContentHtml:'<div class="insert-box"><p>请输入<a href="http://video.sina.com.cn" target="_blank">新浪播客</a>、<a href="http://www.youku.com" target="_blank">优酷网</a>、<a href="http://www.tudou.com" target="_blank">土豆网</a>、<a href="http://www.ku6.com/" target="_blank">酷6网</a>等视频网站的视频播放页链接</p><input type="text" id="xwb_inputor"><a href="#" class="general-btn" rel="e:ok"><span>确定</span></a><p class="error-tips hidden" id="xwb_err_tip">你输入的链接地址无法识别<span><a href="#" rel="e:cc">取消操作</a>或者<a href="#" rel="e:nm">作为普通的链接</a>发布。</span></p></div>',
PictureBox:'<div class="box-style" style="display:none">\t<div class="box-t skin-bg"><span class="skin-bg"></span></div>\t<div class="box-content">   <div class="show-img"><p><a href="#" rel="e:zo" class="icon-piup icon-bg">收起</a>   <a href="{.org}" target="_blank" class="icon-src icon-bg">查看原图</a>   <a href="#" class="icon-trunleft icon-bg" rel="e:tl">向左转</a>   <a href="#" class="icon-trunright icon-bg" rel="e:tr">向右转</a></p>   <div name="img"></div></div>   </div>\t<div class="box-b skin-bg"><span class="skin-bg"></span></div>\t<span class="box-arrow skin-bg"></span></div>',
PictureBoxForward:'<div class="show-img cutline" style="display:none"><p><a class="icon-piup icon-bg" rel="e:zo" href="#">收起</a><a class="icon-src icon-bg" target="_blank" href="{.org}">查看原图</a><a rel="e:tl" class="icon-trunleft icon-bg" href="#">向左转</a><a rel="e:tr" class="icon-trunright icon-bg" href="#">向右转</a></p><div name="img"></div></div>',PreviewBox:'<div class="preview-img"></div>',VideoThumbHtml:'<div class="feed-img"><img width="120px" src="{.img}" alt=""><div class="video-view all-bg" rel="e:pv,i:{.id}"></div></div>',
VideoBox:'<div class="box-style showbox" style="display:none">\t<div class="box-t skin-bg"><span class="skin-bg"></span></div>\t<div class="show-video box-content">   <p><a rel="e:cv" href="#" class="icon-piup icon-bg">收起</a><span>|</span><a title="{.title}" target="_blank" href="{.href}">{.title}</a></p>   <div>{.flash}</div></div>\t<div class="box-b skin-bg"><span class="skin-bg"></span></div>\t<span class="box-arrow skin-bg"></span></div>',VideoBoxForward:'<div class="cutline show-video"><p><a rel="e:cv" href="#" class="icon-piup icon-bg">收起</a><span>|</span><a title="{.title}" target="_blank" href="{.href}">{.title}</a></p><div>{.flash}</div></div>',
MusicBoxContentHtml:'<div class="insert-box music-box"><p>请输入<a href="http://music.sina.com.cn/yueku/" target="_blank">新浪乐库</a>等音乐站点的音乐播放页链接</p><input type="text" id="xwb_inputor"><a href="#" class="general-btn" rel="e:ok"><span>确定</span></a><p class="error-tips hidden" id="xwb_err_tip">你输入的链接地址无法识别<span><a href="#" rel="e:cc">取消操作</a>或者<a href="#" rel="e:nm">作为普通的链接</a>发布。</span></p></div>',UploadImgBtn:'<a href="#" rel="e:dlp" class="icon-close-btn icon-bg" title="删除"></a>',SearchDropdownList:'<ul class="head-searchlist"><li class="mouseover">含<span></span>的微博</li><li>名<span></span>的人</li></ul>',
PrivateMsgContent:'<div class="field"><label>发私信给:</label><input type="text" id="sender" /><em class="warn warn-pos hidden" id="warnPos">她还没有关注你,暂时不能发私信</em></div><div class="field"><label>私信内容:</label><textarea id="content"></textarea></div><input type="hidden" id="uid" value=""><div class="field pad"><div class="icon-face-choose all-bg fl" rel="e:ic"></div><div class="fr"><span class="tips fl" id="word">您还可以输入140个字</span><a class="general-btn highlight fl" href="javascript:;" rel="e:sd"><span>发送</span></a></div></div>',
NoticeLayer:'<div class="new-tips-fixed hidden"><h4 id="xwb_title">提示</h4><p id="wbs" class="hidden"><span id="c">0</span>条新微博，<a href="{.wbsUrl}">点击查看</a></p><p id="fans" class="hidden"><span id="c">0</span>个新粉丝，<a href="{.fansUrl}">点击查看</a></p><p id="cmts" class="hidden"><span id="c">0</span>条新评论，<a href="{.cmtsUrl}">点击查看</a></p><p id="msgs" class="hidden"><span id="c">0</span>封新私信，<a href="{.msgsUrl}">点击查看</a></p><p id="refer" class="hidden"><span id="c">0</span>条微博提到了你，<a href="{.referUrl}">点击查看</a></p><a href="#" class="icon-close-btn icon-bg" id="xwb_cls" ></a></div>',
NoticeLayer2:'<div class="new-tips"><a id="wbs" class="hidden" href="{.wbsUrl}"><span id="c">0</span>条新微博</a><a id="fans" class="hidden" href="{.fansUrl}"><span id="c">0</span>个新粉丝</a><a id="cmts" class="hidden" href="{.cmtsUrl}"><span id="c">0</span>条新评论</a><a id="msgs" class="hidden" href="{.msgsUrl}"><span id="c">0</span>封新私信</a><a id="refer" class="hidden" href="{.referUrl}"><span id="c">0</span>条微博提到了你</a><a href="javascript:;" class="icon-close-btn icon-bg" id="xwb_cls"></a></div>',Login:'<div class="login-area">\t<span><a href="{.regUrl}">注册帐号</a></span><a class="btn-web-account bind-btn-bg" href="{.siteLoginUrl}">{.siteName}登录</a>\t<span><a href="http://t.sina.com.cn/reg.php" target="_blank">开通微博</a></span><a class="btn-sina-account bind-btn-bg" href="#" id="oauth">新浪微博帐号登录</a></div><div class="bind-tips">提示：您可以使用{.siteName}帐号或新浪微博帐号登录本网站</div>',
PostBoxContent:'<div class="post-box"><div class="key-tips" id="xwb_word_cal">您还可以输入<span>140</span>字</div><div class="post-textarea skin-bg"><textarea id="xwb_inputor"></textarea></div><div class="add-area"><a class="icon-face icon-bg" href="#" rel="e:ic">表情</a><span class="pic_uploading hidden" id="xwb_upload_tip">正在上传..</span><span class="hidden" id="xwb_photo_name"><a class="icon-close-btn icon-bg" href="#" ></a></span><a class="icon-pic icon-bg" href="#" id="xwb_btn_img">图片</a><a class="icon-video icon-bg" href="#" id="xwb_btn_vd" rel="e:vd">视频</a><a class="icon-music icon-bg" href="#" id="xwb_btn_ms" rel="e:ms">音乐</a><a class="icon-topic icon-bg" href="#" id="xwb_btn_tp" rel="e:tp">话题</a></div><div class="share-btn skin-bg" rel="e:sd"></div><form class="upload-pic"  method="post"  enctype="multipart/form-data" id="xwb_post_form" action="" target="" id="xwb_imgupload_form"><input type="file" name="pic" id="xwb_img_file" value="" /></form><div class="post-tips">请输入要发布的微博内容</div><div class="post-success all-bg hidden" id="xwb_succ_mask"></div></div>',
AnchorTipContent:'<div class="tips-c"><div class="icon-correct icon-bg"></div><p id="xwb_title"></p></div>',AnchorDlgContent:'<div class="tips-c"><div class="icon-warn icon-bg"></div><p id="xwb_title"></p></div>',SpanBoxContent:'<div class="win-box-inner"><p class="desc">不良信息是指含有色情、暴力、广告或其他骚扰你正常微博生活的内容。</p><p>你要举报的是“{.nick}”发的微博：</p><div class="report-box"><div>{.text}</div><img src="{.img}" class="user" width="30px" height="30px" ></div><p>你可以填写更多举报说明：（选填）</p><p><textarea rows="" cols="" id="content"></textarea></p><div class="foot-con"><p>请放心，你的隐私将会得到保护。<br>举报电话：400 690 0000</p><div class="btn-area"><a href="#" class="general-btn highlight" rel="e:ok"><span>确认举报</span></a><a href="#" class="general-btn" rel="e:cancel"><span>取消</span></a></div></div></div>'};(function(m,g){function p(a,b,d){var k,o=[],A=[];d||(d="\\");for(var D=0,G=a.length;D<G;D++){k=a.charAt(D);if(k===b){o.push(A.join(""));A.length=0}else{if(k===d&&a.charAt(D+1)===b){k=b;D++}A[A.length]=k}}A.length&&o.push(A.join(""));return o}function z(a){var b={},d,k=p(a,",");try{for(var o=0,A=k.length;o<A;o++)if(k[o].indexOf(":")===-1)b[k[o]]=j;else{d=p(k[o],":");b[d[0]]=d[1]}}catch(D){__debug&&console.trace();throw"Syntax Error:rel字符串格式出错。"+a;}return b}function u(a){this.q=a;this.idx=-1;this.end=
this.q.length-1}function w(a){this.mgr=a;this.nextChain=y.bind(this.doNextChain,this)}function h(){return this.view}var j=true,n=document,q=10001,s=m.Tpl,B=m.request,y=m.util=B.util;window.__debug=false;if(window.__debug){if(!window.console)window.console={};(function(a,b){a||(a={});if(b)for(var d in b)if(a[d]===void 0)a[d]=b[d];return a})(console,{debug:g.noop,trace:g.noop,log:g.noop,warn:g.noop,error:g.noop,group:g.noop,groupEnd:g.noop})}g.browser.msie&&g.trim(g.browser.version)=="6.0"&&document.execCommand("BackgroundImageCache",
false,true);var H=/\[\?\.([\w_$]+?)\?([\S\s]*?)\?\]/g,J=/\{(\.?[\w_$]+)\}/g;s.parse=function(a,b){b||(b={});if(a.charAt(0)!=="<"){var d=s[a];if(d)a=d}a=a.replace(H,function(k,o,A){return b[o]===void 0?"":A});return a.replace(J,function(k,o){var A=o.charAt(0)==="."?b[o.substr(1)]:s[o];if(A===void 0||A===null)return"";if(A.toString().charAt(0)==="<")return s.parse(A,b);if(s[A])return s.parse(s[A],b);return A})};s.forNode=function(a,b){if(b)a=this.parse(a,b);return g(a).get(0)};s.get=function(a){return this[a]};
var c=0,e=document.selection;g.extend(y,{arrayRemove:function(a,b){a.splice(b,1)},arrayIndexOf:function(a,b){for(var d=0,k=a.length;d<k;d++)if(a[d]===b)return d;return-1},create:function(){var a=function(){this.init.apply(this,arguments)};if(arguments.length===0)return a;var b,d,k,o=g.makeArray(arguments);if(typeof o[0]==="string"){k=o[0];d=o[1];o.shift()}else d=o[0];o.shift();if(d)d=d.prototype;if(d){b=function(){};b.prototype=d;a.prototype=b=new b}if(k){b.type=k;y.ns(k,a)}k=0;for(var A=o.length;k<
A;k++)g.extend(b,typeof o[k]==="function"?o[k](d):o[k]);return b.constructor=a},domUp:function(a,b,d){d=d||n.body;for(var k=typeof b==="string";a;){if(k){if(g(a).is(b))break}else if(b(a))break;a=a.parentNode;if(a===d)return null}return a},ns:function(a,b){for(var d=a.split("."),k=window,o,A=0,D=d.length-1;A<D;A++){o=d[A];k[o]||(k[o]={});k=k[o]}k[d[A]]=b},calWbText:function(a,b){if(b===void 0)b=140;var d=a.match(/[^\x00-\xff]/g);return Math.floor((b*2-a.length-(d&&d.length||0))/2)},byteLen:function(a){var b=
a.length;if(a=a.match(/[^\x00-\xff]/g))b+=a.length;return b},byteCut:function(a,b){if(y.byteLen(a)>b){var d=a.replace(/&/g," ").replace(/[^\x00-\xff]/g,"&&");a=a.slice(0,d.slice(0,b).replace(/&&/g," ").replace(/&/g,"").length)}return a},stringReplace:function(a,b,d,k){return a.substring(0,d)+b+a.substring(k)},focusEnd:function(a,b){a.focus();if(b===void 0)b=a.value.length;if(document.selection){var d=a.createTextRange();d.collapse();d.moveStart("character",b);d.moveEnd("character",b);d.select()}else a.selectionStart=
a.selectionEnd=b},selectionStart:function(a){if(!e)return a.selectionStart;var b=e.createRange(),d,k=document.body.createTextRange();k.moveToElementText(a);try{for(d=0;k.compareEndPoints("StartToStart",b)<0;d++)k.moveStart("character",1)}catch(o){d=this.getCursorPos(a)}return d},selectionBefore:function(a){return a.value.slice(0,this.selectionStart(a))},selectText:function(a,b,d){a.focus();if(e){a=a.createTextRange();a.collapse(1);a.moveStart("character",b);a.moveEnd("character",d-b);a.select()}else a.setSelectionRange(b,
d)},insertText:function(a,b,d){a.focus();len=len||0;if(d===void 0)d=this.selectionStart(a);if(e){a=e.createRange();a.moveStart("character",-len);a.text=b}else{d-=len;b=d+b.length;a.value=this.selectText(a,b,b)}},hasSelectionSupport:function(){var a=false;if("selectionStart"in document.createElement("TEXTAREA"))a=j;this.hasSelectionSupport=function(){return a};return a},getCursorPos:function(a){var b=0;if(this.hasSelectionSupport()){if(a.selectionStart||a.selectionStart=="0")b=a.selectionStart}else{a.focus();
b=null;b=e.createRange();var d=b.duplicate();d.moveToElementText(a);d.setEndPoint("EndToEnd",b);a.selectionStart=d.text.length-b.text.length;a.selectionEnd=a.selectionStart+b.text.length;b=a.selectionStart}return b},getSelectionText:function(a){var b="";return b=window.getSelection?a.selectionStart!=void 0&&a.selectionEnd!=void 0?a.value.substring(a.selectionStart,a.selectionEnd):"":e.createRange().text},setCursor:function(a,b,d){b=b==null?a.value.length:b;d=d==null?0:d;a.focus();if(a.createTextRange){a=
a.createTextRange();a.move("character",b);a.moveEnd("character",d);a.select()}else a.setSelectionRange(b,b+d)},replaceSelection:function(a,b){a.focus();var d=this.selectionStart(a),k=this.getSelectionText(a).length,o=a.value;k=k===0?d:d+k;a.value=y.stringReplace(o,b,d,k);this.setCursor(a,d+b.length);return d},escapeHtml:function(a){return a?a.replace(/</g,"&lt;").replace(/>/g,"&gt;"):""},disable:function(a,b,d){b?g(a).addClass(d||"general-btn-disabled"):g(a).removeClass(d||"general-btn-disabled")},
getBind:function(a,b){var d="__"+b,k=a[d];k||(k=a[d]=y.bind(a[b],a));return k},uniqueId:function(){return++c},appendParam:function(a,b){var d=this.queryString(b);return a+(a.indexOf("?")!==-1?"&"+d:"?"+d)},getFileName:function(a,b){if(a.indexOf("\\"))a=a.split("\\").pop();if(a.length>b)a=a.substr(0,b-4)+".."+a.substr(a.length-4);return a}});var i=m.Cache={MAX_ITEM_SIZE:3,reg:function(a,b,d){if(this[a])this[a][1]=b;else this[a]=[null,b];d!==void 0&&this.sizeFor(a,d)},get:function(a){a=this[a];if(a===
void 0)return null;var b=a[1];a=a[0];if(a===null)return b();if(a.length>1)return a.pop();if(b)return b();return null},put:function(a,b){var d=this[a];if(d){var k=d[0];k||(d[0]=k=[this.MAX_ITEM_SIZE]);k.length-1>=k[0]||k.push(b)}else this[a]=[[this.MAX_ITEM_SIZE,b]]},remove:function(a){this[a]&&delete this[a]},sizeFor:function(a,b){var d=this[a];d||(this[a]=d=[[]]);d[0]||(d[0]=[]);d[0][0]=b}};i.reg("div",function(){return n.createElement("DIV")});m.getCfg=function(a){return m.cfg&&m.cfg[a]};m.getSiteUid=
function(){return parseInt(m.getCfg("siteUid"))};m.getUid=function(){var a=m.getCfg("uid");return a!=="0"&&a};m.getWb=function(a){var b=m.getCfg("wbList");if(a)return b&&b[a];return b};m.setWb=function(a,b){m.cfg.wbList&&(m.cfg.wbList[a]=b)};g.extend(m,{_cls:{},reg:function(a,b,d){if(this._cls[a]!==void 0&&!d){__debug&&console.trace();throw"已定义类"+a;}return this._cls[a]=b},use:function(a,b){var d=this._cls[a];if(d){if(typeof d==="object")return d;if(typeof b==="function")return new d(b(d.prototype));
return new d(b)}return null},isModule:function(a){return this.getModule()===a},getModule:function(){if(this._mod===void 0)if(this.getCfg("page"))this._mod=this.getCfg("page");else{var a=location.href,b=a.indexOf("?");if(b!==-1)if(a=a.substring(b+1)){a=a.split("&");b=0;for(var d=a.length;b<d;b++){var k=a[b].split("=");if(k.length===2&&k[0]==="m"){this._mod=k[1];break}}}if(this._mod===void 0)this._mod=false;else{a=this._mod.indexOf("#");if(a!=-1)this._mod=this._mod.substring(0,a)}}return this._mod}});
m.ax={};u.prototype={prevented:void 0,stopPropagationed:void 0,get:function(a){var b=this.getRel(a);return b&&b.data&&b.data[a]},escape:function(a){a=this.get(a);if(a!==void 0)return escape(a)},getEl:function(a){return(a=this.getRel(a))&&a.src},jq:function(a,b){var d=g(this.getEl(a));if(b)d=d.find(b);return d},getRel:function(a){for(var b=this.q,d=this.idx,k=this.end;d<=k;d++)if(b[d].data[a]!==void 0)return b[d]},_next:function(){var a=this.q[++this.idx];if(a===void 0)this.idx=0;return a},clone:function(){var a=
new u(this.q);a.idx=0;return a},preventDefault:function(a){this.prevented=a},stopPropagation:function(a){this.stopPropagationed=a},lock:function(a,b){var d="xwb_e_"+this.data.e;if(b)d+="_"+b;if(a===void 0)return g(this.src).data(d);g(this.src).data(d,a)}};m.ax.ActionMgr=m.reg("ActionMgr",function(){this.actions={};this.filters=[];if(this.target){this.bind(this.target);delete this.target}});var l=[];m.ax.ActionMgr.prototype={trigEvent:"click",cacheNodeData:j,reg:function(a,b,d){b={n:a,h:b};d&&g.extend(b,
d);this.actions[a]=b;return this},get:function(a){return this.actions[a]},addFilter:function(a,b){b?l.push(a):this.filters.push(a);return this},bind:function(a,b){var d=this;g(a).bind(b||this.trigEvent,function(k){var o=d.collectRels(k.target,this);o&&d.fireRels(o,k)});return this},doAct:function(a,b){var d=this.collectRels(a,b);return!(d&&this.fireRels(d))},collectRels:function(a,b){var d,k=this.cacheNodeData,o,A=this;y.domUp(a,function(D){var G=g(D);if(k){o=G.data("xwb_rel");if(!o)if(o=G.attr("rel")){o=
{src:D,data:A.parseRel(o)};G.data("xwb_rel",o)}}else if(o=G.attr("rel"))o={src:D,data:A.parseRel(o)};if(o){d||(d=[]);d[d.length]=o}},b);return d},parseRel:function(a){return z(a)},wrapRel:function(a,b){var d=this.collectRels(a,b);d=new u(d);d._next();return d},getRel:function(a,b,d){return this.wrapRel(a,d).get(b)},fireRels:function(a,b){var d=new u(a);d.evt=b;__debug&&console.log("act e:",d);for(var k,o,A=l.length,D=this.filters.length,G,I,L;k=d._next();){o=k.data;if(o.e){d.src=k.src;d.data=o;if(d.lock()){__debug&&
console.warn("action e:"+d.data.e+" has been locked for resubmiting");I=L=G=j;break}else{k=this.actions[o.e];if(A){G=j;if(this._fireArray(l,d,k)===false){L=d.stopPropagationed;I=d.prevented;break}}if(D){G=j;if(this._fireArray(this.filters,d,k)===false)break}L=d.stopPropagationed;I=d.prevented;if(k){var K=d.clone();K.src=d.src;K.data=o;K.evt=b;__debug&&console.log("act e:",K);G||(G=j);if(k.h.call(this,K)===false){if(K.stopPropagationed!==void 0)L=K.stopPropagationed;if(K.prevented!==void 0)I=K.prevented;
break}if(K.stopPropagationed!==void 0)L=K.stopPropagationed;if(K.prevented!==void 0)I=K.prevented}}}}if(b&&G){if(I===void 0)I=j;if(L===void 0)L=j;I&&b.preventDefault();L&&b.stopPropagation()}},_fireArray:function(a,b,d){for(var k=0,o=a.length;k<o;k++)if(a[k].call(this,b,d)===false)return false}};m.reg("action",m.use("ActionMgr"));var r;m.ax.Validator=m.reg("Validator",function(a){g.extend(this,a);this.init()});var t={};w.prototype={doChain:function(a,b,d){var k=a.value;if(typeof k==="string")k=g.trim(k);
this.elVal=k;this.tmpData={};this.elem=a;this.validators=b;this.finalChain=d;this.idx=-1;this.error=0;this.doNextChain()},doNextChain:function(){this.idx++;if(this.idx>=this.validators.length){if(!this.error){__debug&&console.log("onpass",this.elem);this.mgr.onpass(this.elem,this.elVal)}this.finalChain&&this.finalChain()}else{var a=this.validators[this.idx];if(a.isPreCmd)this.nextChain();else typeof a==="function"?a.call(this.mgr,this.elem,this.elVal,t,this.nextChain):a[0].call(this.mgr,this.elem,
this.elVal,a[1],this.nextChain)}}};m.ax.Validator.prototype={useCache:j,autoFocus:j,tipName:"warntip",tipTextNode:"#tle",tipTextType:"",decorateTrigger:j,warnType:1,onerror:function(a,b){var d=g(a).attr(this.tipName);if(d&&b.m){var k=this.elValiChain.tmpData.errors;if(!k)k=this.elValiChain.tmpData.errors=[];k.push(b.m);d=g(d);var o=d.cssDisplay(j).find(this.tipTextNode);o.length||(o=d);if(this.warnType===1){if(k.length==1)this.tipTextType==="text"?o.text(k[0]):o.html(k[0])}else this.tipTextType===
"text"?o.text(k.join("，")):o.html(k.join("，"))}},onpass:function(a){(a=g(a).attr(this.tipName))&&g(a).cssDisplay(false)},onfinal:g.noop,trigOnSubmit:j,reg:function(a,b){r||(r={});if(g.isArray(a))for(var d=0,k=a.length;d<k;d++)this.reg.apply(this,a[d]);else r[a]=b;return this},add:function(a,b){var d=this.extraValidators;if(!d)d=this.extraValidators={};var k=d[a];if(k)k.push(b);else d[a]=[b]},init:function(){r||(r={});this.nextChain=y.bind(this.doNextChain,this);this.elValiChain=new w(this);this.form=
g(this.form).get(0);var a=this;g.each(this.form.elements,function(){for(var d=a.getEleValidators(this,false,this.useCache),k=0,o=d.length;k<o;k++)d[k].isPreCmd&&d[k][0].call(a,this,d[k][1])});a=this;var b=function(){a.validate();return false};if(this.trigOnSubmit)this.form.onsubmit=b;if(this.trigger){this.trigger=g(this.trigger)[0];g(this.trigger).click(function(){return b()})}},validElement:function(a,b,d){if(!this.isGlobalVal){this.error=0;this.validElement0(a,b,d)}},validElement0:function(a,b,
d){b=this.getEleValidators(a,b);if(b.length)this.elValiChain.doChain(a,b,d);else d&&d()},validate:function(){if(!this.isGlobalVal){this.elems=this.form.elements;this.currElIdx=-1;this.error=0;this.isGlobalVal=j;this.data={};this.param&&g.extend(this.data,this.param);this.decorateTrigger&&this.trigger&&y.disable(this.trigger,j);this.doNextChain()}return false},finalChain:function(){this.onfinal();this.isGlobalVal=false;this.data&&delete this.data;this.decorateTrigger&&this.trigger&&y.disable(this.trigger,
false)},parseCmd:function(a){var b=[];a=p(a,"|");for(var d,k=0,o=a.length;k<o;k++){if(a[k].indexOf("=")===-1)d=[a[k],{}];else{d=p(a[k],"=");d[1]=z(d[1])}if(d[0].charAt(0)==="_"){d.isPreCmd=j;d[0]=d[0].substr(1)}b[b.length]=d}return b},getEleValidators:function(a,b){var d;d=false;if(!b){b=g(a).attr("vrel");d=this.useCache}if(b){var k=g(a);if(d)if(k.data("xwb_vd_cmds"))d=k.data("xwb_vd_cmds");else{d=this.parseCmd(b);k.data("xwb_vd_cmds",d)}else d=this.parseCmd(b);k=r;for(var o=this.validators,A,D=0,
G=d.length;D<G;D++){var I=d[D][0];if(typeof I==="string"){A=o&&o[I]||k[I];if(!A){__debug&&console.trace();throw"Undefine cmd :"+I+",in element "+a.name;}d[D][0]=A}}}else d=[];(k=this.extraValidators)&&k[a.name]&&g.merge(d,k[a.name]);return d},report:function(a,b){if(!a){this.error++;this.elValiChain.error++;__debug&&console.log("onerror",this.elValiChain.elem,b);this.onerror(this.elValiChain.elem,b);this.error===1&&this.isGlobalVal&&this.autoFocus&&this.elValiChain.elem.focus()}},setValue:function(a){this.elValiChain.elVal=
a},onsuccess:function(a,b){__debug&&console.log(a);b()},doNextChain:function(){var a=this.elems.length;this.currElIdx>=0&&this.currElIdx<a&&!this.error&&this.collectValue(this.elems[this.currElIdx]);this.currElIdx++;if(this.currElIdx===a)if(this.error)this.finalChain();else this.onsuccess(this.data,this.nextChain)!==false&&this.form.submit();else if(this.currElIdx>a)this.finalChain();else{a=this.elems[this.currElIdx];a.disabled?this.doNextChain():this.validElement0(a,false,this.nextChain)}},collectValue:function(a){if(a.tagName===
"INPUT"&&(a.type==="radio"||a.type==="checkbox")){if(a.checked)this.data[a.name]=a.value}else this.data[a.name]=a.value}};m.ax.Uploader=m.reg("Uploader",function(a){this.init(a)});m.ax.Uploader.prototype={init:function(a){g.extend(this,a);a=this.form;var b="xwb_upload_frame_"+y.uniqueId();this.iframe=s.forNode('<iframe src="about:blank" style="display:none;" id="'+b+'" name="'+b+'"></iframe>');g('<input type="hidden" name="callback"/>').appendTo(a);g(this.iframe).appendTo(n.body);a.target=b;if(!this.action)this.action=
a.action||B.apiUrl("action","upload_pic")},setAction:function(a){this.action=a;return this},isLoading:function(){return!!this.jsonpFn},upload:function(a){this.isLoading()&&this.abort();var b=this,d=this.jsonpFn="jsonp"+(new Date).getTime();window[d]=function(){window[d]=null;delete b.jsonpFn;(a||b.onload).apply(b,arguments);delete b.jsonpFn};this.form.action=y.appendParam(this.action,{callback:"parent."+d,_:y.uniqueId()});this.form.submit()},onload:g.noop,abort:function(){if(this.isLoading()){var a=
this.jsonpFn;window[a]=function(){window[a]=null}}}};m.ax.SelectionHolder=function(a){g.extend(this,a);y.hasSelectionSupport()||this.initEvent(this.elem)};m.ax.SelectionHolder.prototype={pos:-1,length:0,initEvent:function(){var a=this,b=function(){try{a.saveSpot()}catch(d){}};g(this.elem).mouseup(b).keyup(b).data("xwb_selholder",this)},saveSpot:function(){var a=this.elem;this.pos=y.getCursorPos(a);this.length=y.getSelectionText(a).length},insertText:function(a){var b=this.elem,d=b.value;if(y.hasSelectionSupport())y.replaceSelection(b,
a);else if(this.pos===-1){b.value=d+a;y.focusEnd(b)}else{b.value=y.stringReplace(d,a,this.pos,this.pos+this.length);y.setCursor(b,this.pos+a.length)}this.saveSpot()},setText:function(a){this.elem.value=a;try{this.focusEnd()}catch(b){}},clearSpot:function(){this.length=0;this.pos=-1},focusEnd:function(){y.focusEnd(this.elem);this.saveSpot()},focusStart:function(){y.setCursor(this.elem,0);this.saveSpot()}};m.reg("SelectionHolder",m.ax.SelectionHolder);var v=m.reg("contextMgr",{context:function(a){a.contexted&&
this.release(a);var b=this.q;if(!b)this.q=b=[];b.length||g(n).mousedown(this._getDocEvtHandler());b[b.length]=a;this._setCompEvtHandler(a,j);a.contexted=j;__debug&&console.log("contexted",a)},release:function(a,b){a.contexted=false;if(a.onContextRelease(b)!==false){this._setCompEvtHandler(a,false);y.arrayRemove(this.q,a);this.q.length||g(n).unbind("mousedown",this._getDocEvtHandler())}else a.contexted=j;__debug&&console.log("release context",a)},releaseAll:function(a){var b=this.q;if(b){if(a)var d=
a.target;for(var k=b.length-1;k>=0;k--)if(!d||!b[k].ancestorOf(d))this.release(b[k],a)}},_setCompEvtHandler:function(a,b){b?a.domEvent("mousedown",this._compEvtStopHandler):a.unDomEvent("mousedown",this._compEvtHandler)},_getDocEvtHandler:function(){var a=this.docEvtHd;if(!a)a=this.docEvtHd=y.bind(this._docHandler,this);return a},_releaseFollower:function(a,b){var d=this.q;if(d){var k=d.length-1;if(k!==-1&&d[k]!==a)for(;k>=0;k--){if(d[k]===a)break;this.release(d[k],b)}}},_compEvtStopHandler:function(a){v._releaseFollower(this,
a);return false},_compEvtHandler:function(a){v._releaseFollower(this,a)},_docHandler:function(a){this.releaseAll(a)}}),x=m.ui={Base:y.create()},C=x.Base;x.Base.prototype={autoRender:false,titleNode:"#xwb_title",init:function(a){this.cacheId="c"+y.uniqueId();a&&g.extend(this,a);this.initUI();this.autoRender&&this.getView()},initUI:g.noop,clsNode:"#xwb_cls",initClsBehave:function(a){this.jq(this.clsNode).click(y.bind(this.onClsBtnClick,this));this.setCloseable(a)},setCloseable:function(a){this.fly(this.clsNode).display(a);
this.closeable=a},onClsBtnClick:function(){this.close(j);return false},close:function(){if(!this.onclose||this.onclose()!==false)this.destroyOnClose?this.destroy():this.display(false)},tplData:false,createView:function(){var a=this.view;if(typeof a==="string")a=this.view=s.forNode(s[a],this.tplData||this,j);else this.view=a=n.createElement("DIV");return a},innerViewReady:g.noop,setTitle:function(a){this.jq(this.titleNode).html(a);return this},getView:function(){var a=this.view;if(!a||!a.tagName)a=
this.createView();this.getView=h;if(this.hidden!==void 0){var b=this.hidden;this.hidden=void 0;this.display(!b)}if(this.appendTo){g(this.appendTo).append(a);delete this.appendTo}this.closeable!==void 0&&this.initClsBehave(this.closeable);if(this.actionMgr===j){this.actionMgr=m.use("ActionMgr");this.actionMgr.bind(a);if(this.onactiontrig){var d=this;this.actionMgr.addFilter(function(k){return d.onactiontrig(k)})}}this.innerViewReady(a);this.onViewReady&&this.onViewReady(a);return a},beforeShow:g.noop,
afterShow:g.noop,beforeHide:g.noop,jqExtra:function(){for(var a=arguments,b=0,d=a.length;b<d;b++){var k=a[b],o=this.jq("#"+k);if(o){k=k.charAt(0).toUpperCase()+k.substring(1);this["jq"+k]=o}}return this},display:function(a){var b=this.jq();if(a===void 0)return!b.hasClass("hidden");a=!a;if(this._flied||this.hidden!==a)if(a){if(this.beforeHide()!==false){this.hidden=a;b.addClass("hidden");this.afterHide&&this.afterHide();this.contexted&&this.setContexted(false)}}else{this.hidden=a;b.css("visibility",
"hidden").removeClass("hidden");this.beforeShow();b.css("visibility","");this.contextable&&!this.contexted&&this.setContexted(j);this.afterShow()}return this},onContextRelease:function(){this.display(false)},appendAt:function(a){g(a).append(this.getView());return this},ancestorOf:function(a,b){a=a.view||a;var d=this.view;if(d.contains&&!g.browser.webkit)return d.contains(a);else if(d.compareDocumentPosition)return!!(d.compareDocumentPosition(a)&16);if(b===void 0)b=65535;for(var k=a.parentNode,o=n.body;k!=
o&&b>0&&k!==null;){if(k==d)return j;k=k.parentNode;b--}return false},jq:function(a){return a===void 0?g(this.getView()):g(this.getView()).find(a)},fly:function(a){if(typeof a==="string")a=this.jq(a);return C.fly(a)},unfly:function(){delete this.view},destroy:function(){this.display(false);this.jq().remove()},domEvent:function(a,b,d){if(a==="mousedown"){var k=this,o=function(A){k.contexted||v.releaseAll(A);b.apply(k,arguments)};if(!this._mousedownFns)this._mousedownFns={};this._mousedownFns[b]=o;this.jq(d).bind(a,
o)}else this.jq(d).bind(a,b)},unDomEvent:function(a,b,d){if(a==="mousedown"){var k=this._mousedownFns[b];this.jq(d).unbind(a,k);delete this._mousedownFns[b]}else this.jq(d).unbind(a,b)},setContexted:function(a){if(this.contexted!==a)a?v.context(this):v.release(this);return this},templ:function(a){for(var b in a)this.jq(b).html(a[b]);return this},offset:function(){if(arguments.length){this.jq().css(arguments[0]);return this}return this.jq().offset()},anchor:function(a,b,d){var k=g(a);a=this.jq();var o=
k.offset(),A=k.width();k.height();k=a.width();var D=a.height(),G=b.charAt(0),I=b.charAt(1);b=o.left;o=o.top;switch(G){case "t":o-=D}switch(I){case "c":b+=Math.floor((A-k)/2)}if(d){A=A=[b,o];d(A,k,D);b=A[0];o=A[1]}a.css("left",b+"px").css("top",o+"px")},center:function(){var a=this.jq(),b=[M.width(),M.height()];a=[a.width(),a.height()];var d=(b[1]-a[1])*0.8;this.view.style.left=Math.max((b[0]-a[0])/2|0,0)+g(n).scrollLeft()+"px";this.view.style.top=Math.max(d-d/2|0,0)+g(n).scrollTop()+"px";return this},
clip:function(){if(!C.CLIP_WRAPPER_CSS){C.CLIP_WRAPPER_CSS={position:"absolute",clear:"both",overflow:"hidden"};C.CLIPPER_CSS={position:"absolute",left:0,top:0}}if(!this.jqClipWrapper){var a=g(i.get("div")),b=this.getView(),d=this.jq(),k=b.parentNode,o=d.offset();a.css(C.CLIP_WRAPPER_CSS).css(o).css("width",d.width()+"px").css("height",d.height()+"px").css("z-index",d.css("z-index")).append(b);o=this._tmpClipedCss={};for(var A in C.CLIPPER_CSS)o[A]=b.style[A];d.css(C.CLIPPER_CSS);k&&a.appendTo(k);
this.jqClipWrapper=a}return this.jqClipWrapper},unclip:function(){if(this.jqClipWrapper){var a=this.jqClipWrapper[0],b=a.style,d=this.jq(),k=d[0].style,o;for(o in C.CLIP_WRAPPER_CSS)b[o]="";this.jqClipWrapper.css("overflow","").css("width","").css("height","");b=this._tmpClipedCss;for(o in b)k[o]=b[o];delete this._tmpClipedCss;a.removeChild(d[0]);a.parentNode&&this.jqClipWrapper.replaceWith(d);i.put("div",a);delete this.jqClipWrapper}},slide:function(a,b,d,k,o,A){var D=this.jq(),G=D.width(),I=D.height(),
L=0,K=0,O=0,P=0;this.clip();var R=a.charAt(0);a=a.charAt(1);switch(R){case "l":L=0-G;break;case "r":L=0+G;break;case "t":K=0-I;break;case "b":K=0+I}switch(a){case "l":O=0-G;break;case "r":O=0+G;break;case "t":P=0-I;break;case "b":P=0+I}D.css("left",L).css("top",K);k||(k={});if(O!=L)k.left=k.left===void 0?O:k.left+O;if(P!=K)k.top=k.top===void 0?P:k.top+P;b&&D.css("visibility","");var Q=this;D.animate(k,o||"fast",A,function(){if(!b){Q.display(false);D.css("visibility","")}setTimeout(function(){Q.unclip();
d&&d(Q)},0)})}};var E=new x.Base;E._flied=j;E.unfly=function(){this.view=null};C.fly=function(a){if(a)if(typeof a==="string")a=g(a)[0];else if(a.get)a=a[0];E.view=a;return E};m.reg("base",C);var F={layers:[],hash:{},keyListeners:0,add:function(a){var b=a.cacheId;if(!this.hash[b]){this.layers.push(a);if(a.keyEvent){if(this.keyListeners===0){__debug&&console.log("bind key listener");g(n).bind("keydown",this.getEvtHandler())}this.keyListeners++}this.hash[b]=j}},remove:function(a){var b=a.cacheId;if(this.hash[b]){var d=
this.layers;d[d.length-1]===a?d.pop():y.arrayRemove(d,a);this.keyListeners--;if(this.keyListeners===0){__debug&&console.log("remove key listener");g(n).unbind("keydown",this.getEvtHandler())}delete this.hash[b]}},getEvtHandler:function(){var a=this._onDocKeydown;if(!a)a=this._onDocKeydown=y.bind(this.onDocKeydown,this);return a},onDocKeydown:function(a){var b=this.layers[this.layers.length-1];if(b&&b.keyEvent)return b.onKeydown(a)}},M=g(window),N=x.Layer=y.create(C,{hidden:j,onViewReady:g.noop,trackZIndex:function(){if(this.z!==
q){q+=3;this.mask&&g(this.mask).css("z-index",q-1);this.frameMask&&g(this.getFrameMask()).css("z-index",q-2);this.jq().css("z-index",q);this.z=q}},keyEvent:j,onKeydown:function(a){if(a.keyCode===27&&!this.cancelEscKeyEvent){this.close();return false}},beforeShow:function(){this.mask&&this._applyMask(j);var a=this.jq().css("position");if(a==="absolute"||a==="fixed")this.trackZIndex();F.add(this);this.autoCenter&&this.center()},afterHide:function(){this.mask&&this._applyMask(false);F.remove(this)},
getFrameMask:function(){if(this.frameMaskEl)return this.frameMaskEl;return this.frameMaskEl=s.forNode('<iframe class="shade-div shade-iframe" frameborder="0"></iframe>')},_applyMask:function(a){var b=this.mask;if(!b||b===j)b=this.mask=s.forNode(s.Mask);var d=M.height();if(a){g(b).height(d).appendTo(n.body);this.frameMask&&g(this.getFrameMask()).height(d).appendTo(n.body);g(window).bind("resize",y.getBind(this,"onMaskWinResize"))}else{g(b).remove();this.frameMask&&g(this.getFrameMask()).remove();g(window).unbind("resize",
y.getBind(this,"onMaskWinResize"))}},onMaskWinResize:function(){var a=this.mask,b=M.height();a&&g(a).height(b);this.frameMask&&g(this.getFrameMask()).height(b);this.autoCenter&&this.center()}});m.reg("Layer",N);x.Switcher=function(a){a&&g.extend(this,a);this.initUI()};m.reg("Switcher",x.Switcher);x.Switcher.prototype={trigMode:"click",initUI:function(){this.items&&this.add(this.items,this.contents)},select:function(a){var b=this.selectedItem;this.autoRecover&&this.clearTimer(1);if(this.selectedCS){b&&
g(b).removeClass(this.selectedCS);g(a).addClass(this.selectedCS)}this.onselect&&this.onselect(a);this.selectedItem=a;if(a.contentEl){var d=a.contentEl;setTimeout(function(){b&&b.contentEl&&C.fly(b.contentEl).display(false).unfly();C.fly(d).display(j).unfly()},0)}},unselect:function(a){this.selectedCS&&g(a).removeClass(this.selectedCS);a.contentEl&&C.fly(a.contentEl).display(false).unfly();this.mouseoutTimer&&this.clearTimer(1);this.selectedItem=null},clearTimer:function(a){if(a!==0){if(this.mouseoutTimer){clearTimeout(this.mouseoutTimer);
this.mouseoutTimerFn=this.mouseoutTimer=false}}else if(this.mouseoverTimer){clearTimeout(this.mouseoverTimer);this.mouseoverTimerFn=this.mouseoverTimer=false}},add:function(a,b){if(a.length)if(b)for(var d=0,k=a.length;d<k;d++)this.add(a[d],b[d]);else{d=0;for(k=a.length;d<k;d++)this.add(a[d])}else{d=g(a);var o=this;if(d.hasClass(this.selectedCS)){this.selectedItem&&this.unselect();this.selectedItem=a}if(b)a.contentEl=b;if(this.trigMode==="hover"||this.autoRecover)d.hover(function(){o.autoRecover&&
o.mouseoutTimer&&o.clearTimeout(1);if(o.trigMode==="hover")if(this!==o.selectedItem)if(o.delaySelect){o.mouseoverTimer&&o.clearTimeout(0);o.mouseoverTimer=setTimeout(function(){o.select(a)},o.delaySelect)}else o.select(this);return!o.enableBubble},function(A){o.mouseoverTimer&&o.clearTimeout(0);if(o.trigMode==="hover"){if(this!==o.selectedItem&&o.mouseoutTimerFn){o.mouseoutTimerFn();o.mouseoutTimerFn=null}A=A.target;var D=C.fly(this);if(o.autoRecover&&(A===this||D.ancestorOf(A)))if(!o.mouseoutTimer){var G=
this;o.mouseoutTimerFn=function(){o.unselect(G)};o.mouseoutTimer=setTimeout(o.mouseoutTimerFn,o.delayHide||500)}D.unfly()}return!o.enableBubble});if(this.trigMode==="click")d.bind(this.clickEvent||"mousedown",function(){o.select(this)})}}};x.Box=m.reg("Box",y.create(x.Layer,{view:"Box"}));x.Tip=m.reg("Tip",y.create(x.Box,{cs:"win-fixed",autoHide:j,timeoutHide:500,stayHover:false,offX:25,offY:-10,innerViewReady:function(){var a=this.jq();this.stayHover&&a.hover(y.bind(this.onMouseover,this),y.bind(this.onMouseout,
this))},onMouseover:function(){this.clearHideTimer()},onMouseout:function(){this.setHideTimer()},clearHideTimer:function(){if(this.hideTimerId){clearTimeout(this.hideTimerId);this.hideTimerId=false}},beforeShow:function(){if(N.prototype.beforeShow.apply(this,arguments)===false)return false;this.autoHide&&this.setHideTimer()},setHideTimer:function(){this.clearHideTimer();this.hideTimerId=setTimeout(this._getHideTimerCall(),this.timeoutHide)},_onTimerHide:function(){this.display(false)},_getHideTimerCall:function(){if(!this._onHideTimer)this._onHideTimer=
y.bind(function(){this._onTimerHide();this.clearHideTimer()},this);return this._onHideTimer}}));x.Dialog=m.reg("Dlg",y.create(x.Box,function(a){return{cs:"win-tips win-fixed",contentHtml:"DialogContent",focusBtnCs:"highlight",mask:j,closeable:j,initUI:function(){if(this.buttons&&!this.buttonHtml){for(var b=[],d=0,k=this.buttons,o=k.length;d<o;d++)b.push(s.parse(this.buttonTpl||"Button",k[d]));this.buttonHtml=b.join("")}a.initUI.call(this)},setFocus:function(b){if(b||this.defBtn)this.jq("#xwb_btn_"+
(b||this.defBtn)).focus().addClass(this.focusBtnCs)},afterShow:function(){a.afterShow.call(this);this.defBtn&&this.setFocus()},onbuttonclick:function(b){__debug&&console.log(b+" clicked")},setHandler:function(b){this.onbuttonclick=b;return this},getButton:function(b){return this.jq("#xwb_btn_"+b)},innerViewReady:function(b){a.innerViewReady.call(this,b);var d=this;g(b).find("#xwb_dlg_btns").click(function(k){if(k=y.domUp(k.target,function(A){return A.id&&A.id.indexOf("xwb_btn_")===0},this)){var o=
k.id.substr(8);d.buttons&&g.each(d.buttons,function(){if(this.id===o){var A;if(this.onclick)A=this.onclick(d);if(A!==false&&d["on"+o])A=d["on"+o]();A!==false&&d.onbuttonclick(o)!==false&&d.close()}});return false}})}}}));x.MsgBox=m.reg("msgbox",{getSysBox:function(){var a=this.sysBox;if(!a)a=this.sysBox=m.use("Dlg",{appendTo:n.body,title:"提示",dlgContentHtml:"MsgDlgContent",mask:j,buttons:[{title:"确&nbsp;定",id:"ok"},{title:"取&nbsp;消",id:"cancel"},{title:"&nbsp;是&nbsp;",id:"yes"},{title:"&nbsp;否&nbsp;",
id:"no"},{title:"关&nbsp;闭",id:"close"}],setContent:function(b){this.jq("#xwb_msgdlg_ct").html(b)},setIcon:function(b){var d=a.jq("#xwb_msgdlg_icon");d.attr("className",d.attr("className").replace(/icon\-\S+/i,"icon-"+b))},afterHide:function(){x.Dialog.prototype.afterHide.call(this);this.onbuttonclick=x.Dialog.prototype.onbuttonclick}});return a},getTipBox:function(){var a=this.tipBox;if(!a)a=this.tipBox=m.use("Tip",{cs:"win-tips win-fixed",contentHtml:"DialogContent",appendTo:n.body,view:"Box",title:"提示",
timeoutHide:1200,dlgContentHtml:"MsgDlgContent",setContent:function(b){this.jq("#xwb_msgdlg_ct").html(b)},setIcon:function(b){var d=a.jq("#xwb_msgdlg_icon");d.attr("className",d.attr("className").replace(/icon\-\S+/i,"icon-"+b))},afterHide:function(){x.Tip.prototype.afterHide.call(this);if(this.onhide){this.onhide();this.onhide=false}}});return a},getAnchorDlg:function(){var a=this._anchorDlg;if(!a)a=this._anchorDlg=m.use("Dlg",{cs:"win-tips-ask",mask:false,dlgContentHtml:"AnchorDlgContent",appendTo:n.body,
defBtn:"ok",buttons:[{title:"确&nbsp;定",id:"ok"},{title:"取&nbsp;消",id:"cancel"}],setAnchor:function(b){this.anchorEl=b;return this},beforeShow:function(){x.Dialog.prototype.beforeShow.call(this);if(this.anchorEl){this.anchor(this.anchorEl,"tc",function(d){d[1]-=2});var b=this;this.slide("bc",j,function(){x.Dialog.prototype.afterShow.call(b)})}},afterShow:g.noop,beforeHide:function(){if(this.anchorEl){this.slide("cb",false);delete this.anchorEl;return false}else x.Dialog.prototype.beforeHide.call(this)},
afterHide:function(){x.Dialog.prototype.afterHide.call(this);this.onbuttonclick=x.Dialog.prototype.onbuttonclick}});return a},getAnchorTip:function(){var a=this._anchorTip;if(!a)a=this._anchorTip=m.use("Tip",{view:"Box",cs:"operate-success",contentHtml:"AnchorTipContent",appendTo:n.body,timeoutHide:1800,setAnchor:function(b){this.anchorEl=b;return this},beforeShow:function(){if(this.anchorEl){this.anchor(this.anchorEl,"tc",function(b){b[1]-=8});this.slide("bc",j)}x.Tip.prototype.beforeShow.call(this)},
beforeHide:function(){if(this.anchorEl){this.slide("cb",false);delete this.anchorEl;return false}else x.Tip.prototype.beforeHide.call(this)}});return a},tipError:function(a,b){this.tip(a,"error",b)},tipOk:function(a,b){this.tip(a,"success",b)},tipWarn:function(a,b){this.tip(a,"alert",b)},anchorTipOk:function(a,b){this.anchorTip(a,b)},anchorConfirm:function(a,b,d){this.getAnchorDlg().setTitle(b).setHandler(d).setAnchor(a).display(j)},tip:function(a,b,d){var k=this.getTipBox();k.setIcon(b||"alert");
k.setContent(a||"");k.display(j);d&&(k.onhide=d)},anchorTip:function(a,b){this.getAnchorTip().setTitle(b).setAnchor(a).display(j)},alert:function(a,b,d,k,o,A){var D=this.getSysBox(),G=D.buttons,I=C.fly(D.view);k||(A=k="ok");o||(o="alert");for(var L=0,K=G.length;L<K;L++)I.fly(D.jq("#xwb_btn_"+G[L].id).get(0)).display(k.indexOf(G[L].id)>=0);I.unfly();D.defBtn=A;a&&D.setTitle(a);b&&D.setContent(b);o&&D.setIcon(o);d&&(D.onbuttonclick=d);D.display(j);return D},confirm:function(a,b,d,k){this.alert(a||"提示",
b,d,"ok|cancel","ask",k||"ok")},success:function(a,b,d,k,o){this.alert(a,b,d,k||"ok","success",o||"ok")},error:function(a,b,d,k,o){this.alert(a,b,d,k||"ok","error",o||"ok")}})})(Xwb,$);(function(m,g){var p=true,z=parseInt,u=!!(g.browser.msie&&g.browser.version=="6.0"),w=function(){this.cid="imageCtrler";this.canvas=null;this.maxWidth=440;this.curAngle=this.height=this.width=0};w.prototype={init:function(h){h=h.el;this.width=h.offsetWidth;this.height=h.offsetHeight;if(g.browser.msie){h.style.filter="progid:DXImageTransform.Microsoft.Matrix()";h.filters.item("DXImageTransform.Microsoft.Matrix").SizingMethod="auto expand";g(h).addClass("narrow-move")}else{this.canvas=g("<canvas></canvas>").attr({height:this.height,
width:this.width}).addClass("narrow-move").attr("rel","e:zo").insertBefore(h)[0];if(this.canvas.getContext){g(h).hide();this.canvas.getContext("2d")}}this.element=h},rotate:function(h){if(this.element){if(h==="right"){h=this.curAngle+90;this.curAngle=h>=360?0:h}else if(h==="left"){h=this.curAngle-90;this.curAngle=h<0?360+h:h}var j,n;h=this.width;var q=this.height;this.width=q;this.height=h;if(q>this.maxWidth){h=z(this.maxWidth*h/q);q=this.maxWidth}if(this.canvas){var s=this.canvas.getContext("2d"),
B=this.element,y=0,H=0;g(this.canvas).attr({width:q,height:h});s.clearRect(0,0,q,h);switch(this.curAngle){case 0:H=y=0;j=q;n=h;break;case 90:y=q;H=0;j=h;n=q;break;case 180:y=q;H=h;j=q;n=h;break;case 270:y=0;j=H=h;n=q}s.save();s.translate(y,H);s.rotate(this.curAngle*Math.PI/180);s.drawImage(B,0,0,j,n);s.restore()}else{B=this.curAngle*Math.PI/180;s=Math.cos(B);B=Math.sin(B);y=this.element;y.filters.item("DXImageTransform.Microsoft.Matrix").M11=s;y.filters.item("DXImageTransform.Microsoft.Matrix").M12=
-B;y.filters.item("DXImageTransform.Microsoft.Matrix").M21=B;y.filters.item("DXImageTransform.Microsoft.Matrix").M22=s;switch(this.curAngle){case 0:case 180:j=q;n=h;break;case 90:case 270:j=h;n=q}y.width=j;y.height=n;if(g.browser.version==8)y.parentNode.style.height=y.offsetHeight+18}}}};g.extend(g.fn,{zoomText:function(h,j){this.each(function(){var n,q=g(this),s=q.offset(),B=q.text();j=isNaN(j)?2:j;isNaN(+B)||(B=+B+(h||1));q.text(B);n=q.clone().attr("id","").css({position:"absolute",top:s.top,left:s.left,
font:q.css("font"),color:q.css("color")}).appendTo(g(document.body));B=j*parseInt(q.css("font-size"));n.animate({"font-size":B,top:s.top-q.height()/4,left:s.left-q.width()/2,opacity:0.1},{duration:300,complete:function(){n.remove()}})});return this},imgRotate:function(h){this.each(function(){if(this.tagName!=="IMG")return false;var j=g(this).data("img");if(!j){j=new w;j.init({el:this});j.maxWidth=g(this).parent().width();g(this).data("img",j)}j.rotate(h)});return this},focusText:function(h,j,n,q){this.each(function(){g(this).focus(function(){if(this.value===
h){var s=g(this).data("xwb_selholder");if(s)s.setText("");else this.value=""}if(j)q?g(n||this).removeClass(j):g(n||this).addClass(j)}).blur(function(){if(g.trim(this.value)===""){var s=g(this).data("xwb_selholder");if(s)s.setText(h);else this.value=h}if(j)q?g(n||this).addClass(j):g(n||this).removeClass(j)})})},cssDisplay:function(h){var j=this.length,n;if(j)if(j===1){n=m.ui.Base.fly(this[0]);if(h===undefined){j=n.display();n.unfly();return j}else n.display(h).unfly()}else{n=m.ui.Base.fly();this.each(function(){n.fly(this).display(h)});
n.unfly()}return this},substrText:function(h,j){var n=RegExp("(?:<a.*?>.*?<\\/a>)|(?:<img.*?>)|.","gi");this.each(function(){var q=q||"...",s=this.innerHTML;s=s.match(n);h=h||10;if(s&&s.length>h){s=s.slice(0,h).join("");s=j?s:s.replace(/<img.*?title=\"(.*?)\".*?>/gi,"[$1]");g(this).html(s+q)}});return this},fixPng:function(){u&&this.each(function(){if(this.tagName=="IMG"){var h=g("<span></span>").css({width:this.offsetWidth,height:this.offsetHeight,display:"inline-block"});h[0].style.filter='progid:DXImageTransform.Microsoft.AlphaImageLoader(src="'+
this.src+'", sizingMethod="scale")';g(this).replaceWith(h)}});return this}});(function(){function h(){s=/INPUT|IMG|SCRIPT|STYLE|HEAD|MAP|AREA|TEXTAREA|SELECT|META|OBJECT|IFRAME/i;B=/^\s+$/;y=/(\.|\\|\/|\*|\?|\+|\[|\(|\)|\]|\{|\}|\^|\$|\|)/g;H=/</g;J=/>/g;c=p}function j(e,i){c||h();if(typeof e==="string")e=g.trim(e).split(B);for(var l=[],r=0,t=e.length;r<t;r++)if(e[r]&&!B.test(e[r]))l[l.length]=e[r].replace(H,"&lt;").replace(J,"&gt;").replace(y,"\\$1");var v=RegExp("("+l.join("|")+")","gi"),x='<span class="'+
(i||j.cls)+'">$1</span>',C=document.createElement("DIV");this.each(function(){n(this,v,x,C)});return this}function n(e,i,l,r){var t=e.childNodes,v=[],x,C;x=0;for(C=t.length;x<C;x++)s.test(t[x].tagName)||v.push(t[x]);x=0;for(C=v.length;x<C;x++){t=v[x];if(t.nodeType===3)try{t=t;var E=i,F=l,M=r,N=t.data;if(!B.test(N)){N=N.replace(H,"&lt;").replace(J,"&gt;");if(E.test(N)){M||(M=document.createElement("DIV"));M.innerHTML=N.replace(E,F);var a=M.childNodes;E=[];var b=document.createDocumentFragment();F=
0;for(var d=a.length;F<d;F++)E[F]=a[F];for(F=0;F<d;F++)b.appendChild(E[F]);t.parentNode.replaceChild(b,t)}}}catch(k){}else arguments.callee(t,i,l,r)}}function q(e,i){var l=e.childNodes,r=[],t,v,x;t=0;for(v=l.length;t<v;t++)s.test(l[t].tagName)||r.push(l[t]);t=0;for(v=r.length;t<v;t++){l=r[t];x=l.nodeType;if(x!==3)if(x===1&&l.tagName==="SPAN"&&l.className===i){x=l.childNodes[0];var C=l.parentNode,E=l.previousSibling,F=l.nextSibling;if(E&&E.nodeType===3){C.removeChild(E);x.data=E.data+x.data}if(F&&
F.nodeType===3){C.removeChild(F);x.data+=F.data}C.replaceChild(x,l)}else arguments.callee(l,i)}}var s,B,y,H,J,c;g.fn.highlight=j;g.fn.clearHighlight=function(e){c||h();e=e||j.cls;this.each(function(){q(this,e)})};j.cls="search-txt"})();g.cookie=function(h,j,n){if(typeof j!="undefined"){n=n||{};if(j===null){j="";n.expires=-1}var q="";if(n.expires&&(typeof n.expires=="number"||n.expires.toUTCString)){if(typeof n.expires=="number"){q=new Date;q.setTime(q.getTime()+n.expires*24*60*60*1E3)}else q=n.expires;
q="; expires="+q.toUTCString()}var s=n.path?"; path="+n.path:"",B=n.domain?"; domain="+n.domain:"";n=n.secure?"; secure":"";document.cookie=[h,"=",encodeURIComponent(j),q,s,B,n].join("")}else{j=null;if(document.cookie&&document.cookie!=""){n=document.cookie.split(";");for(q=0;q<n.length;q++){s=jQuery.trim(n[q]);if(s.substring(0,h.length+1)==h+"="){j=decodeURIComponent(s.substring(h.length+1));break}}}return j}}})(Xwb,jQuery);(function(m,g){var p=true,z=null,u=m.ui,w=m.util,h=document,j=u.Base,n=m.Tpl,q=m.request,s=m.use("msgbox"),B=m.getCfg,y=m.getUid,H=m.getWb,J=m.setWb;u.Emotion=m.reg("emotion",function(){var c=m.use("Box",{contentHtml:"Loading",boxOutterHtml:"ArrowBoxBottom",cs:"win-emotion",appendTo:h.body,closeable:p,actName:"em",contextable:p,actionMgr:p,emotions:z,$categorySelected:z,$categoryShowed:z,cateMaps:{},onactiontrig:function(e){switch(e.data.e){case "em":if(this.onselect)if(this.onselect(this.findEmotionText(e),
e)===false)break;this.display(false);break;case "sc":this.emSwitch(e.data.idx,e.src)}},setHandler:function(e){this.onselect=e;return this},setSelectionHolder:function(e,i,l){this.setHandler(function(r){e.insertText(r);i&&i.call(l||this,e,r)});return this},showAt:function(e){e=g(e).offset();e.left-=22;e.top+=20;this.offset(e).display(p)},initEmotion:function(e){if(e.isOk()){e=e.getData();var i={},l=[],r=[],t=0,v={};g.each(e,function(C,E){if(E.type=="face"){var F=E.category?E.category:"默认";if(i[F])i[F].push(E);
else{i[F]=[E];v[t]=i[F];r.push(['<a href="#" rel="e:sc,idx:',t,'">',F,"</a>"].join(""));t++}E.is_hot&&l.push(['<a href="#" rel="e:em" title="',E.phrase,'"><img width="22px" height="22px" src="',E.url,'" /></a>'].join(""))}});var x=[];g.each(i["默认"],function(C,E){x.push(['<a href="#" rel="e:em" title="',E.phrase,'"><img width="22px" height="22px" src="',E.url,'" /></a>'].join(""))});if(l.length>15)l=l.slice(0,15);e={category:r.join(""),faces:x.join(""),hotList:l.join("")};e=g(n.parse("EmotionBoxContent",
e));this.jq("#xweibo_loading").hide();this.jq("#xwb_dlg_ct").append(e);this.$categorySelected=this.jq("#cate>a:first").addClass("current");this.$categoryShowed=this.jq("#flist0");this.emotions=i;this.cateMaps=v}},createEmArea:function(e){var i=['<div class="e-list" id="flist'+e+'">'];g.each(this.cateMaps[e],function(l,r){i.push(['<a href="#" rel="e:em" title="',r.phrase,'"><img width="22px" height="22px" src="',r.url,'" /></a>'].join(""))});i.push("</div>");return g(i.join(""))},emSwitch:function(e,
i){var l=g(i);if(!l.hasClass("current")){this.$categorySelected.removeClass("current");this.$categorySelected=l.addClass("current");this.$categoryShowed.addClass("hidden");e>0?this.jq("#hotEm").addClass("hidden"):this.jq("#hotEm").removeClass("hidden");l=this.jq("#flist"+e);l.length||(l=this.createEmArea(e).appendTo(this.jq("#box")));this.$categoryShowed=l.removeClass("hidden")}},loadEmotion:function(){var e=this;q.getEmotion(function(i){e.initEmotion(i)})},onViewReady:function(){this.loadEmotion()},
onInputRecev:function(){},findEmotionText:function(e){return e.src.title}});m.reg("emotion",c,p);return c});u.ForwardBox=m.reg("forwardBox",function(){var c=m.use("Dlg",{cs:"win-forward",appendTo:h.body,autoCenter:p,dlgContentHtml:"ForwardDlgContentHtml",title:"转发到我的微博",defBtn:"forward",buttons:[{title:"转 发",id:"forward"},{title:"取 消",id:"cancel"}],checkText:function(){var e=g.trim(this.jqInputor.val()),i=w.calWbText(e);i>=0?this.jqWarn.html("您还可以输入"+i+"字").removeClass("out140"):this.jqWarn.html("已超出"+
Math.abs(i)+"字").addClass("out140");return i>=0&&e},onViewReady:function(){this.jq("#xwb_face_trig").click(w.bind(this.onFaceTrig,this));this.jqInputor=this.jq("#xwb_fw_input");this.jqWarn=this.jq("#xwb_warn_tip");this.jqContent=this.jq("#xwb_forward_text");this.jqLabelCt=this.jq("#xwb_fw_lbl");this.jqInputor.bind("keyup",w.bind(this.onInputorKeyup,this));this.selectionHolder=m.use("SelectionHolder",{elem:this.jqInputor[0]})},onInputorKeyup:function(){this.checkText()},onFaceTrig:function(e){m.use("emotion").setSelectionHolder(this.selectionHolder,
this.checkText,this).showAt(e.target);return false},setContent:function(e,i,l){this._predCfg={id:e,data:i,uid:l};this.jq();var r=[];l!==i.u.id&&r.push(n.parse("ForwardDlgLabel",{uid:e,nick:i.u.sn}));var t=i.rt;if(t){e=t.tx;i="//@"+i.u.sn+":"+i.tx;t.u.id!=l&&r.push(n.parse("ForwardDlgLabel",{uid:t.id,nick:t.u.sn}))}else{e=i.tx;i=""}this.jqContent.text(w.escapeHtml(e));this.selectionHolder.setText(i);this.checkText();this.jqLabelCt.html(r.join(""));return this},submit:function(){if(this.isLoading)return false;
this.isLoading=p;var e=this.checkText();if(e==="")e="转发微博";else if(!e){this.jqInputor.focus();return this.isLoading=false}var i=[];this.jq('input[type="checkbox"]:checked').each(function(){i[i.length]=g(this).val()});var l=this._predCfg;w.disable(this.getButton("forward"),p);q.repost(l.id,e,i.join(","),w.getBind(this,"onSubmitLoad"))},onSubmitLoad:function(e){w.disable(this.getButton("forward"),false);this.close();e.isOk()?s.tipOk("转发成功"):s.tipError(e.getMsg());this.isLoading=false},onbuttonclick:function(e){if(e===
"forward"){this.submit();return false}}});m.reg("forwardBox",c,p);return c});u.getFlash=function(c,e){var i=g.browser.msie;c=c||{};var l='<object width="'+c.width+'" height="'+c.height+(c.id?'" id="'+c.id:"")+(c.name?'" name="'+c.name:"")+'"';if(c.nocache)c.src+=(c.src.indexOf("?")!=-1?"&":"?")+Math.random();l+=c.w3c||i?' data="'+c.src+'" type="application/x-shockwave-flash"':' classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"';l+=">";if(c.w3c||i)l+='<param name="movie" value="'+c.src+'" />';c.width=
c.height=c.id=c.w3c=c.src=z;c.onFail=c.version=c.expressInstall=z;for(var r in c)if(c[r])l+='<param name="'+r+'" value="'+c[r]+'" />';i="";if(e){for(var t in e)if(e[t]){r=e[t];i+=t+"="+(/function|object/.test(typeof r)?f.asString(r):r)+"&"}i=i.slice(0,-1);l+='<param name="flashvars" value=\''+i+"' />"}l+="</object>";return l};u.WbElement=m.reg("WbElement",w.create(j,{init:function(){j.prototype.init.apply(this,arguments);this.picLoadState=0;this.isFw=this.wbData.rt?1:0;this.$preview=this.$wb.find("div.preview-img")},
playVideo:function(c){c.get("w");c=c.get("i");c=B("urls")[c];var e=this.$wb.find("div.feed-content").width()-35,i=parseInt(e/1.25);i=u.getFlash({src:c.flash,width:e,height:i,w3c:1,id:"sinaVideo_"+ +new Date,quality:"high",allowScriptAccess:"always",wmode:"transparent",allowFullscreen:"TRUE",flashvars:"playMovie=TRUE"});this.$video&&this.$video.remove();var l;if(this.isFw){e="div.forward>p";l="VideoBoxForward"}else{e="p.feed-main";l="VideoBox"}c=n.parse(l,{href:c.url,title:c.title,flash:i});this.$video=
g(c).insertAfter(this.$wb.find(e));this.switchView("video",1)},closeVideo:function(){this.switchView("video",0)},loadPic:function(){this.picLoadState=1;var c=this,e=this.wbData;e=this.isFw?{org:e.rt.op,img:e.rt.mp}:{org:e.op,img:e.mp};var i=this.$thumbImg=this.$wb.find("img.zoom-move");this.$loadEl=g('<div class="loading-img"></div>').appendTo(i.parent());this.$picBox=g(n.parse(this.isFw?"PictureBoxForward":"PictureBox",e));i=this.img=new Image;g(i).bind("load",function(){c.onPicLoaded()}).addClass("narrow-move").attr("rel",
"e:zo").attr("src",e.img)},onPicLoaded:function(){var c=this.$wb.find(this.isFw?"div.forward":"div.feed-content:first"),e=this.img,i=this.$picBox;c.css("visibility","hidden");var l=this.$wb.find("div.feed-content").width()-35;g(e).appendTo(i.find("div[name=img]"));c.children("div.preview-img").after(i);this.switchView("pic",1);if(e.width>l){if(g.browser.msie)e.height*=l/e.width;e.width=l}c.css("visibility","");this.$loadEl.remove();this.picLoadState=2},zoomIn:function(){if(this.picLoadState==0)this.loadPic();
else this.picLoadState==2&&this.switchView("pic",1)},zoomOut:function(){this.switchView("pic",0)},trun:function(c){g(this.img).imgRotate(c)},switchView:function(c,e){if(e){if(c=="pic"){this.$picBox.show();this.$video&&this.$video.remove();this.$video=z}else if(c=="video"){this.$video.show();this.$picBox&&this.$picBox.hide()}this.$preview.hide()}else{if(c=="pic")this.$picBox&&this.$picBox.hide();else if(c=="video"){this.$video&&this.$video.remove();this.$video=z}this.$preview.show()}}}));u.CmtBox=
m.reg("CmtBox",w.create(j,{actionMgr:p,view:"CmtBox",autoH:p,wbUid:z,headPicType:1,innerViewReady:function(c){this.wbUid=m.getUid();j.prototype.innerViewReady.call(this,c);this.jqExtra("inputor","warn","sync");this.selectionHolder=m.use("SelectionHolder",{elem:this.jqInputor[0]});var e=this;this.jqInputor.bind("keyup",function(i){e.onInputorKeyup(i)})},reset:function(){this.getView();this.selectionHolder.setText("");this.jqSync.attr("checked",false);this.checkText()},checkText:function(){var c=this.jqInputor,
e=g.trim(c.val()),i=w.calWbText(e);i>=0?this.jqWarn.html("还可以输入"+i+"字"):this.jqWarn.html("已超出"+Math.abs(i)+"字");this.autoH&&c.height()!==c[0].scrollHeight&&c.css("height",c[0].scrollHeight);return i>=0&&e},send:function(){if(!this.sending){var c=this.checkText();if(c){this.sndBtn&&w.disable(this.sndBtn,p);this.sending=p;var e=this.jqInputor.data("xwb_reply_cid");e&&/^回复@.*?:/.test(c)?q.reply(this.wbId,e,c,this.jqSync.attr("checked")?1:0,this.headPicType,w.getBind(this,"onSendLoad"),{data:{_route:m.getModule()}}):
q.comment(this.wbId,c,this.jqSync.attr("checked")?1:0,this.headPicType,w.getBind(this,"onSendLoad"),{data:{_route:m.getModule()}})}else setTimeout(w.bind(function(){this.jqInputor.focus()},this),0)}},onSendLoad:function(c){if(c.isOk()){this.pCt.afterSend(c);this.reset();c=c.getData();c.html&&this.pCt.postWeibo(c.wb,c.html)}else s.tipWarn(c.getMsg());this.jqInputor.focus();this.sndBtn&&w.disable(this.sndBtn,false);this.sending=false},reply:function(c,e){var i=this.selectionHolder,l=this.jqInputor;
i.setText("回复@"+e+":"+l.val().replace(/^回复@.*?:/,""));l.data("xwb_reply_cid",c);setTimeout(function(){i.focusEnd()},0)},onFaceTrig:function(c){m.use("emotion").setSelectionHolder(this.selectionHolder,this.checkText,this).showAt(c.src);return false},onInputorKeyup:function(){this.checkText()},onactiontrig:function(c){switch(c.data.e){case "ic":this.onFaceTrig(c);break;case "sd":if(!this.sndBtn)this.sndBtn=c.src;this.send()}}}));u.CommentArea=m.reg("CmtArea",w.create(j,{view:"CommentArea",readSize:10,
cmtType:1,hdPicSz:30,cmtCount:0,page:1,cmtBoxHtml:"CmtBox",commentHtml:"Comment",actionMgr:p,cmtBox:"CmtBox",initUI:function(){this.cmtUrl=q.mkUrl("show","","id="+this.wbId);this.jqExtra("pre","first","next");j.prototype.initUI.call(this)},getFromUser:function(){if(!this.wbUid){var c=H(this.wbId);this.wbUid=c&&c.u.id}return this.wbUid},innerViewReady:function(c){j.prototype.innerViewReady.call(this,c);this.jqExtra("cmtCt","more","lefCnt");this.initCmtBox()},decorateLoading:function(){this.isLoading?
g(n.get("Loading")).appendTo(this.getView().parentNode):g(this.getView().parentNode).find("#xweibo_loading").remove();this.display(!this.isLoading)},initCmtBox:function(){this.cmtBox=m.use("CmtBox",{view:this.jq("#cmtBox")[0],wbId:this.wbId,pCt:this,headPicType:this.hdPicSz==30?1:2});this.cmtBox.getView()},load:function(c){this.getView();this.cmtBox.reset();if(!this.isLoading){this.isLoading=p;this.decorateLoading();c&&(this.onload=c);q.getComments(this.wbId,this.page,this.cmtType,w.getBind(this,
"onCmtsLoad"))}},postWeibo:function(c,e){var i=m.use("weiboList");i&&i.append(c.id,c,e)},afterSend:function(c){this.jqCmtCt.prepend(g(this.createCmtUI(c.getData().comment)));this.jqCmtCt.cssDisplay(p);this.updateCmtCountUI(1,p)},onCmtsLoad:function(c){if(c.isOk()){this.createListUI(c);var e=c.getData().total;e&&this.updateCmtCountUI(e);this.updateCmtPageUI(c.getData())}this.isLoading=false;this.decorateLoading();this.onload&&this.onload(c)},createListUI:function(c){this.jqCmtCt.empty();var e=c.getData();
e=e.total-Math.min(e.limit,e.total);var i=[];c.each(function(l){i[i.length]=this.createCmtUI(l)},this);if(i.length){this.jqCmtCt.html(i.join(""));if(e){this.jqMore.cssDisplay(p);this.jqLefCnt.text(e)}else this.jqMore.cssDisplay(false);this.jqCmtCt.cssDisplay(p)}else{this.jqCmtCt.cssDisplay(false);this.jqMore.cssDisplay(false)}},createCmtUI:function(c){var e=this.getFromUser(),i=y();c.verifiedHtml=c.user.verified_html;c.usrUrl=c.user.profileUrl;c.picSz=this.hdPicSz;c.time=c.create_at;if(e===i||c.uid===
i)c.canDel=p;return n.parse(this.commentHtml,c)},updateCmtPageUI:function(c){if(this.jqPre.length){this.jqPre.cssDisplay(this.page!==1);this.jqFirst.cssDisplay(this.page>=3);this.jqNext.cssDisplay(c.total!=0)}},updateCmtCountUI:function(c,e){if(this.trigEl)if(e===void 0){g(this.trigEl).text("评论("+c+")");this.cmtCount=c}else{this.cmtCount+=c;g(this.trigEl).text("评论("+this.cmtCount+")")}},onactiontrig:function(c){switch(c.data.e){case "rp":this.onReplyTrig(c);break;case "dl":this.onDelTrig(c);break;
case "nx":this.goPage(this.page+1);break;case "pr":this.goPage(this.page-1);break;case "fi":this.goPage(1)}},onDelTrig:function(c){var e=this;s.anchorConfirm(c.src,"确定要删除该评论吗？",function(i){if(i==="ok"&&!e.deletingCmt){e.deletingCmt=p;q.delComment(c.get("c"),function(l){var r=c.getEl("c");if(l.isOk()){g(r).remove();e.updateCmtCountUI(-1,p);e.cmtCount==0&&e.cmtBox.jqInputor.focus()}else s.tipError(l.getMsg());e.deletingCmt=false})}})},onReplyTrig:function(c){var e=c.get("c");c=c.get("n");this.cmtBox.reply(e,
c)},goPage:function(c){this.page=c;this.load()}}));u.MBlogCmtArea=m.reg("MBlogCmtArea",w.create(u.CommentArea,{commentHtml:"MBlogCmt",cmtType:2,hdPicSz:50,createListUI:function(c){this.jqCmtCt.empty();c.getData();var e=[],i=this.faceSize;c.each(function(l){if(i)l.profileImg=l.profileImg.replace("/30/","/"+i+"/");e[e.length]=this.createCmtUI(l)},this);if(e.length){this.jqCmtCt.html(e.join(""));this.jqCmtCt.cssDisplay(p)}else{this.jqCmtCt.cssDisplay(false);this.jqMore.cssDisplay(false)}},initCmtBox:function(){this.cmtBox=
m.use("CmtBox",{wbId:this.wbId,pCt:this,view:"MBCmtBox",headPicType:this.hdPicSz==30?1:2});this.cmtBox.getView();this.topCmtBox=m.use("CmtBox",{wbId:this.wbId,pCt:this,autoH:false,view:this.topCmtBox,headPicType:this.hdPicSz==30?1:2});this.topCmtBox.getView()},updateCmtCountUI:g.noop,onReplyTrig:function(c){this.cmtBox.jq().insertAfter(c.jq("c").find("#trigs"));var e=c.get("c");c=c.get("n");this.cmtBox.display(p).reply(e,c)},postWeibo:g.noop,afterSend:function(c){this.jqCmtCt.prepend(g(this.createCmtUI(c.getData().comment))).cssDisplay(p);
this.cmtBox.display(false);this.topCmtBox.jqInputor.focus()},onload:function(){this.jq("#pager").cssDisplay(true);this.topCmtBox.jqInputor.focus()}}));u.MyCmt=m.reg("MyCmt",w.create(j,{actionMgr:p,innerViewReady:function(c){j.prototype.innerViewReady.call(this,c);this.jqExtra("cmtCt");var e=this;this.jqCmtCt.find("li").each(function(){g(this).hover(e.onItemMouseover,e.onItemMouseout)})},onItemMouseover:function(){var c=g(this).data("dlEl");if(!c){c=g(this).find("a[rel=e:dl]");g(this).data("dlEl",
c)}c.cssDisplay(p)},onItemMouseout:function(){var c=g(this).data("dlEl");if(!c){c=g(this).find("a[rel=e:dl]");g(this).data("dlEl",c)}c.cssDisplay(false)},onactiontrig:function(c){switch(c.data.e){case "sa":this.selectAll(c.src.checked);c.preventDefault(false);break;case "da":this.delSelected();break;case "rp":var e=c.jq("c","#cmtBoxCt"),i=c.get("c"),l=c.get("w");c=c.get("n");this.getCmtBox().jq().insertAfter(e);this.reply(l,i,c);break;case "dl":this.delCmt(c.get("c"),c.src)}},afterSend:function(c){this.jqCmtCt.prepend(g(this.createCmtUI(c.getData().comment))).cssDisplay(p);
this.cmtBox.display(false)},postWeibo:g.noop,selectAll:function(c){this.jq("li label input:checkbox[rel=cdl],input:checkbox[rel=e:sa]").each(function(){if(!this.disabled)this.checked=c})},delSelected:function(){var c=[],e=m.use("action"),i=this.jqCmtCt[0];this.jqCmtCt.find("li label input:checkbox[rel=cdl]").each(function(){this.checked&&c.push(e.getRel(this,"c",i))});c.length&&s.confirm("","确定删除所有选择评论？",w.bind(function(l){l=="ok"&&q.delComment(c.join(","),function(){location.reload()})},this))},
getCmtBox:function(){if(!this.cmtBox){this.cmtBox=m.use("CmtBox",{pCt:this,view:"MBCmtBox"});this.cmtBox.getView()}return this.cmtBox},reply:function(c,e,i){var l=this.getCmtBox();l.wbId=c;l.selectionHolder.setText("");l.jqInputor.css("height","");l.display(p).reply(e,i)},delCmt:function(c,e){s.anchorConfirm(e,"确定要删除该回复吗？",function(i){i=="ok"&&q.delComment(c,function(){location.reload()})})},createCmtUI:function(){s.tipOk("回复成功！")}}));u.VideoBox=m.reg("videoBox",function(){var c=m.use("Box",{cs:" win-insert",
contentHtml:"MediaBoxContentHtml",boxOutterHtml:"ArrowBoxBottom",appendTo:h.body,actionMgr:p,closeable:p,contextable:p,onViewReady:function(){this.jqInputor=this.jq("#xwb_inputor");this.jqTip=this.jq("#xwb_err_tip");this.selectionHolder=m.use("SelectionHolder",{elem:this.jqInputor[0]})},onactiontrig:function(e){switch(e.data.e){case "ok":if(e=this.checkText()){this.onselect&&this.onselect(e);this.close()}else this.jqInputor.focus();break;case "cc":this.close();break;case "nm":this.onselect&&this.onselect(g.trim(this.jqInputor.val()));
this.close()}},checkText:function(){var e=this.jqInputor,i=this.selectionHolder,l=g.trim(e.val());if(l==""||l=="http://"){setTimeout(function(){e.focus();i.setText("http://");e.select()});return false}else if(!this.checkUrl(l)){this.jqTip.cssDisplay(p);return false}return l},checkUrl:function(e){return e.indexOf("http://")===0},showAt:function(e,i){this.onselect=i;var l=g(e).offset();l.left-=140;l.top+=20;this.offset(l).display(p);var r=this;setTimeout(function(){r.selectionHolder.setText("http://");
r.jqInputor.focus();r.jqInputor[0].select()},0);this.jqTip.cssDisplay(false)}});m.reg("videoBox",c,p);return c});u.MusicBox=m.reg("musicBox",function(){return m.use("Box",{cs:" win-insert",contentHtml:"MusicBoxContentHtml",boxOutterHtml:"ArrowBoxBottom",appendTo:h.body,closeable:p,actionMgr:p,contextable:p,onViewReady:function(){this.jqInputor=this.jq("#xwb_inputor");this.jqTip=this.jq("#xwb_err_tip");this.selectionHolder=m.use("SelectionHolder",{elem:this.jqInputor[0]})},checkText:function(){var c=
this.jqInputor,e=g.trim(c.val()),i=this.selectionHolder;if(e==""||e=="http://"){setTimeout(function(){c.focus();i.setText("http://");c[0].select()});return false}else if(!this.checkUrl(e)){this.jqTip.cssDisplay(p);return false}return e},checkUrl:function(c){return c.indexOf("http://")===0},onactiontrig:function(c){switch(c.data.e){case "ok":if(c=this.checkText()){this.onselect&&this.onselect(c);this.close()}else this.jqInputor.focus();break;case "cc":this.onselect&&this.onselect();this.close();break;
case "nm":this.onselect&&this.onselect(g.trim(this.jqInputor.val()));this.close()}},showAt:function(c,e){this.onselect=e;var i=g(c).offset();i.left-=140;i.top+=20;this.offset(i).display(p);var l=this;setTimeout(function(){l.selectionHolder.setText("http://");l.jqInputor.focus();l.jqInputor[0].select()},0);this.jqTip.cssDisplay(false)}})});u.PostBase={actionMgr:p,initEx:function(){var c=this.jqInputor=this.jq("#xwb_inputor"),e=this.jqSendBtn=this.jq("#xwb_send_btn"),i=c.parent();this.jqWarn=this.jq("#xwb_word_cal");
this.jqImgFile=this.jq("#xwb_img_file");this.jqBtnImg=this.jq("#xwb_btn_img");this.jqUploadTip=this.jq("#xwb_upload_tip");this.jqPhotoName=this.jq("#xwb_photo_name");this.jqForm=this.jq("#xwb_post_form");this.selectionHolder=m.use("SelectionHolder",{elem:this.jqInputor[0]});var l=this;this.jqImgFile.change(function(r){l.onImgFileChange(r)});this.btnHoverCS&&e.hover(function(){e.addClass(l.btnHoverCS)},function(){e.removeClass(l.btnHoverCS)});c.bind("keyup",function(r){l.onInputorKeyup(r)}).bind("focus",
function(){i.addClass("post-focus")}).bind("blur",function(){i.removeClass("post-focus")})},getUploader:function(){if(!this.uploader)this.uploader=m.use("Uploader",{form:this.jqForm[0],action:q.mkUrl("api/weibo/action","upload_pic"),onload:w.getBind(this,"onUploadLoad")});return this.uploader},reset:function(){this.jqUploadTip.cssDisplay(false);this.jqPhotoName.cssDisplay(false);this.jqBtnImg.cssDisplay(p);this.jqForm.cssDisplay(p);this.jqImgFile.val("");this.selectionHolder.setText("");this.jqForm[0].reset();
this.uploadPic=false;this.checkText();return this},onactiontrig:function(c){switch(c.data.e){case "sd":this.post();break;case "ic":m.use("emotion").setSelectionHolder(this.selectionHolder,this.checkText,this).showAt(c.src);break;case "vd":m.use("videoBox").showAt(c.src,w.getBind(this,"onBoxTextReturn"));break;case "ms":m.use("musicBox").showAt(c.src,w.getBind(this,"onBoxTextReturn"));break;case "tp":this.insertTopic();break;case "dlp":this.uploadPic=false;this.jqBtnImg.cssDisplay(p);this.jqForm.cssDisplay(p);
this.jqPhotoName.cssDisplay(false);this.jqInputor.focus()}},onBoxTextReturn:function(c){c&&this.selectionHolder.insertText(c);this.checkText()},checkText:function(){var c=g.trim(this.jqInputor.val()),e=w.calWbText(c);e>=0?this.jqWarn.html("您还可以输入<span>"+e+"</span>字").removeClass("out140"):this.jqWarn.html("已超出<span>"+Math.abs(e)+"</span>字").addClass("out140");return e>=0&&c},checkImg:function(c){c=c.split(".");return c.length&&g.inArray(c.pop().toLowerCase(),["jpg","png","gif","jpeg"])!==-1},onInputorKeyup:function(){this.checkText()},
TOPIC_TIP:"请在这里输入自定义话题",insertTopic:function(c){if(!c)c=this.TOPIC_TIP;var e=this.jqInputor[0],i=RegExp("#"+this.TOPIC_TIP+"#").test(e.value),l=c,r=0,t=0;e.focus();if(document.selection){var v=document.selection.createRange();l=v.text||c;if(l==c&&i){r=RegExp.leftContext.length+1;t=c.length}else if(l==c){v.text="#"+c+"#";r=e.value.indexOf("#"+c+"#")+1;t=c.length}else v.text="#"+l+"#";if(l==c){v=e.createTextRange();v.collapse();v.moveStart("character",r);v.moveEnd("character",t)}v.select()}else if(e.selectionStart||
e.selectionStart=="0"){r=e.selectionStart;t=e.selectionEnd;if(r!=t)l=e.value.substring(r,t);if(i&&l==c){r=RegExp.leftContext.length+1;t=r+l.length}else if(l==c){e.value=e.value.substring(0,r)+"#"+l+"#"+e.value.substring(t,e.value.length);r++;t=r+l.length}else{e.value=e.value.substring(0,r)+"#"+l+"#"+e.value.substring(t,e.value.length);t=r=r+l.length+2}e.selectionStart=r;e.selectionEnd=t}else e.value+="#"+l+"#";this.checkText();this.selectionHolder.saveSpot()},post:function(){var c=this.checkText();
if(c)if(this.getUploader().isLoading())s.tipWarn("图片正在上传，请稍候..");else if(this.sending)s.tipWarn("正在发布,请稍候..");else{this.sending=p;q.post(c,w.getBind(this,"onSendLoad"),this.uploadPic,{data:{_route:m.getModule()}})}else this.jqInputor.focus()},onImgFileChange:function(){var c=this.jqImgFile.val(),e=this;this.uploadPic=z;if(!c||!this.checkImg(c)){this.jqForm[0].reset();s.alert("","只支持 jpg、png、gif 的图片。",function(){e.jqInputor.focus()})}else{this.jq("#xwb_upload_tip").cssDisplay(p);this.jqForm.cssDisplay(false);
this.jqBtnImg.cssDisplay(false);this.getUploader().upload()}},onUploadLoad:function(c){c=q.parseProtocol(c);if(c.isOk()){this.uploadPic=c.getData().msg;this.jqPhotoName.html(w.getFileName(this.jqImgFile.val(),10)+n.get("UploadImgBtn"));this.jqPhotoName.cssDisplay(p);!g.trim(this.jqInputor.val())&&this.selectionHolder.setText("分享图片");this.checkText()}else{s.alert("",c.getMsg());this.jqBtnImg.cssDisplay(p);this.jqForm.cssDisplay(p)}this.jqUploadTip.cssDisplay(false);this.jqForm[0].reset();this.jqInputor.focus()},
onSendLoad:function(c){var e=this.jqInputor;if(c.isOk()){var i=this.jq("#xwb_succ_mask");i.show().cssDisplay(p);e.focus();i.fadeOut(1800,function(){i.cssDisplay(false);i[0].style.display=""});this.reset();var l=m.use("weiboList");if(l){var r=c.getData();g.each(r.data,function(t,v){l.append(t,v,r.html)})}}else s.alert("",c.getMsg(),function(){w.focusEnd(e[0])});this.sending=false}};m.reg("postBox",function(){var c=g.extend({},u.PostBase);g.extend(c,{title:"发微博",closeable:p,autoCenter:p,appendTo:h.body,
mask:p,cs:"win-post",contentHtml:"PostBoxContent",onViewReady:function(){this.initEx()},onbuttonclick:function(e){if(e=="ok"){this.post();return false}},onSendLoad:function(e){u.PostBase.onSendLoad.call(this,e);if(e.isOk()){var i=this;setTimeout(function(){i.close();i.jq("#xwb_succ_mask").hide().cssDisplay(false)},500)}}});c=m.use("Box",c);m.reg("postBox",c,p);return c});u.WeiboList=m.reg("WeiboList",w.create(j,{ctNode:"#xwb_weibo_list_ct",innerViewReady:function(c){j.prototype.innerViewReady.call(this,
c);this.jqCt=this.jq(this.ctNode);this.wbList=H()},append:function(c,e,i){this.item(c,e);if(i){i=g.trim(i);var l=this;g(i).prependTo(this.jqCt).hide().fadeIn(1E3,function(){var r={};r[c]=e;l.renderLink(r)})}},item:function(c,e){if(e===void 0)return H(c);J(c,e)},renderLink:function(c){u.linkRender(c)}}));u.SearchEntry=m.reg("SearchEntry",w.create(j,{focusText:"搜索微博/找人",focusCs:"search-box-focus",maxLen:30,innerViewReady:function(c){j.prototype.innerViewReady.call(this,c);c=this.jqInputor=this.jq("#xwb_inputor");
var e=this;this.jq("#xwb_trig").click(function(){return e.submit()});c.keydown(function(i){i.keyCode===13&&e.submit()});this.focusText&&c.focusText(this.focusText,this.focusCs,this.getView())},submit:function(){var c=g.trim(this.jqInputor.val());if(c==this.focusText)c="";if(c){c=encodeURIComponent(w.byteCut(c,this.maxLen));c=q.mkUrl("search","","k="+c);window.location.href=c}else this.jqInputor.focus()}}));(function(){function c(e){e=e||H();var i={urls:[],map:{}},l;if(e){var r=i.map,t=i.urls,v=/http:\/\/sinaurl\.cn\/([0-9a-z]+)/gi,
x;for(x in e)g.each([e[x],e[x].rt],function(C,E){if(E)for(var F=E.tx;v.test(F);){l=RegExp.$1;r[l]||(r[l]=[]);t.push(l);r[l].push([x,C])}})}return i.urls.length?i:z}u.linkRender=function(e){var i=c(e);i&&q.sinaurl(i.urls.join(","),function(l){var r=m.cfg;if(l.isOk()){l=l.raw.data;var t=i.map;if(r.urls)g.each(l,function(v,x){r.urls[v]=x});else r.urls=l;g.each(l,function(v,x){g.each(t[v],function(C,E){var F=E[1],M=g("div.feed-list>ul>li[rel=w:"+E[0]+"]"),N=x.type,a="http://sinaurl.cn/"+v;M=g(M);var b=
M.find("div.forward"),d=M.find("p.feed-main");a=F?b.next("p").find("a[href="+a+"]"):d.find("a[href="+a+"]");switch(N){case "music":a.attr("title",x.url).addClass("icon-music-url icon-bg");break;case "video":a.attr("title",x.title).addClass("icon-video-url icon-bg");if(F){N=b.find(">div.preview-img");N.length||g(n.parse("PreviewBox")).appendTo(b)}else{N=d.next("div.preview-img");N.length||g(n.parse("PreviewBox")).insertAfter(d)}if(F||!F&&!b.length){a.attr("rel","e:pv,i:"+v);N=n.parse("VideoThumbHtml",
{img:x.screen,id:v});g(N).appendTo(M.find((F?"div.forward ":"")+"div.preview-img"))}break;default:a.attr("title",x.url)}})})}})}})();m.reg("myMsg",function(){var c=m.use("Box",function(e){return{contentHtml:"PrivateMsgContent",appendTo:h.body,cs:"win-mes",actionMgr:p,title:"发私信",autoCenter:p,closeable:p,mask:p,onViewReady:function(){var i=this;this.jqExtra("word","warn","sender","content","warnPos","uid");this.jqContent.keyup(w.bind(this.checkText,this));this.jqSender.blur(function(){var l=g.trim(this.value);
i.checkFans(l,1,z,p)});this.selectionHolder=m.use("SelectionHolder",{elem:this.jqContent[0]})},checkText:function(){var i=g.trim(this.jqContent.val()),l=w.calWbText(i,140);this.jqWord.html(l>=0?"您还可以输入"+l+"个字":"已超出"+Math.abs(l)+"字");return l>=0&&i},afterShow:function(){e.afterShow.call(this);this.jqSender.val()===""?this.jqSender.focus():this.jqContent.focus()},onactiontrig:function(i){switch(i.data.e){case "sd":this.send();break;case "ic":m.use("emotion").setSelectionHolder(this.selectionHolder,
this.checkText,this).showAt(i.src)}},send:function(){if(!this.sending){var i=this.validate(),l=w.getBind(this,"onSendLoad"),r=this.jqSendBtn;i&&this.checkFans(i.u,i.t,function(){w.disable(r,p);q.msg(i.u,i.t,i.c,l)})}},onSendLoad:function(i){if(i.isOk()){this.display(false);location.reload()}else{var l;switch(i.getCode()){case 20014:s.alert("",i.getMsg());break;case 1010005:alert("内容长度不能超过140个字。");this.jqContent.focus();break;default:l=i.getMsg()}l&&this.display()&&this.jqWarnPos.cssDisplay(p).text(l)}this.sending=
false;w.disable(this.jqSendBtn,false)},checkFans:function(i,l,r,t){var v=this;i?q.followed(i,function(x){if(x.isOk())if(x.getData()){v.jqWarnPos.cssDisplay(false);r&&r.call(this,x)}else{v.jqWarnPos.cssDisplay(p).text(q.ERRORMAP["20016"]);!t&&v.jqSender.focus()}else{v.jqWarnPos.cssDisplay(p).text(x.getMsg());!t&&v.jqSender.focus()}},l):v.jqWarnPos.cssDisplay(p).text("请输入要发送的用户昵称。")},reset:function(){this.jqSender.attr("disabled",false).val("");this.jqContent.val("");this.jqUid.val("");this.jqWarnPos.cssDisplay(false);
return this},validate:function(){var i=g.trim(this.jqSender.val()),l=this.checkText(),r=this.jqUid.val();if(i)if(l){if(r)return{u:r,c:l};return{u:i,c:l,t:1}}else{g.trim(this.jqContent.val()).length?alert("内容长度不能超过140个字。"):alert("请输入私信内容。");this.jqContent.focus()}else this.jqSender.focus()},reply:function(i,l){this.getView();this.reset();this.display(p);this.jqSender.val(l).attr("disabled",p);this.jqUid.val(i);this.jqContent.focus()}}});m.reg("myMsg",c,p);return c});m.reg("notice",function(c){var e=
m.use("Layer",function(i){var l=g("#new_wb_tips");return g.extend({view:"NoticeLayer2",hidden:p,closeable:p,actionMgr:p,remindType:1,clearOnClose:p,types:["wbs","refer","cmts","fans","msgs"],interval:3E4,wbsUrl:q.mkUrl("index"),referUrl:q.mkUrl("index","atme"),cmtsUrl:q.mkUrl("index","comments"),msgsUrl:q.mkUrl("index","messages"),fansUrl:q.mkUrl("index","fans"),initUI:function(){if(this.remindType)this.view="NoticeLayer";i.initUI.call(this);this.getView();this.interval&&this.doCheck()},push:function(r,
t,v){r=this.jq("#"+r);var x=r.find("#c"),C=parseInt(x.text());v||(t+=C);if(t!=C){x.text(t);t>0&&r.cssDisplay(!!t)}if(t&&!this.display())this.display(p);else{v=t=0;for(r=this.types.length;v<r;v++)parseInt(this.jq("#"+this.types[v]).find("#c").text())==0&&t++;t==r&&this.display(false)}},onclose:function(){this.clearOnClose&&this.clearUnread()},clearUnread:function(){var r=this;g.each(this.types,function(){var t=r.jq("#"+this);t.cssDisplay(false);t.find("#c").text("0")});q.clearUnread("",g.noop)},latestWid:0,
doCheck:function(){if(!this.checking){this.checking=p;q.unread(this.latestWid,w.getBind(this,"oncheckLoad"))}},oncheckLoad:function(r){if(r.isOk()){r=r.getData().unread;for(var t=0,v=this.types.length;t<v;t++)if(t==0){if(l.length)parseInt(r[t])?l.show().css("display","block"):l.hide()}else r[t]&&this.push(this.types[t],r[t],p)}this.checking=false;this.interval&&setTimeout(w.getBind(this,"doCheck"),this.interval)}},c)});m.reg("notice",e,p);return e});m.reg("skin",function(c){c=m.use("base",g.extend({actionMgr:p,
skinSelectedCS:"current",onViewReady:function(){this.tab=m.use("Switcher",this.tab)},onactiontrig:function(e){switch(e.data.e){case "cs":this.change(e.get("sk"),e.get("id"));this.decorateSelected(e.src);break;case "sv":if(this.using)this.save(this.using);else{this.display(false);this.reload()}break;case "cc":this.usedSkin&&this.change(this.usedSkin);this.close();this.reload()}},beforeHide:function(){if(g.browser.msie){var e=m.Cache.get("div");g("#wrapper").css("clear","both");m.Cache.put(e)}},change:function(e,
i){var l=this;g("link[rel=stylesheet]").each(function(){if(this.href.indexOf("/skin.css")!==-1){if(!l.usedSkin)l.usedSkin=this.href.match(/\/css\/(.*)\/skin.css/i)[1];this.href=this.href.replace(/\/css\/.*\/skin.css/i,"/css/"+e+"/skin.css")}});this.using=i},save:function(e){var i=this;q.saveSkin(e,function(l){if(l.isOk()){i.display(false);i.reload()}else s.alert("",l.getMsg())})},reload:function(){window.location=String(window.location.href).replace(/skinset[^A-Za-z0-9\/]{1}1/g,"")},decorateSelected:function(e){if(!this.jqPreSel)this.jqPreSel=
this.jq("#tabPanels ."+this.skinSelectedCS);this.jqPreSel.removeClass(this.skinSelectedCS);this.jqPreSel=g(e);this.jqPreSel.addClass(this.skinSelectedCS)}},c));m.reg("skin",c,p);return c});u.oAuthLogin={logWin:z,show:function(c){var e=this.logWin,i=this;if(e&&!e.closed)e.focus();else{this.logWin=window.open(q.mkUrl("account","sinaLogin","popup=1&cb="+(c||"")),"logWin","resizable=1,location=0,status=0,scrollbars=0,width=510,height=400");if(!window.loginCallback)window.loginCallback=function(l){i.logWin.close();
if(l)window.location.href=l;else{l=m.getCfg("page");if(!l.indexOf("pub")||!l.indexOf("index"))window.location.reload();else window.location.href=q.mkUrl("pub")}}}},bind:function(c,e){e=e||"click";var i=this;g(c).bind(e,function(){i.show()})}};u.LoginBox=m.reg("LoginBox",function(){var c=m.use("Box",{contentHtml:"Login",cs:"win-bind-login win-fixed",appendTo:h.body,mask:p,siteName:B("siteName"),siteLoginUrl:q.mkUrl("account","siteLogin"),regUrl:m.getCfg("siteReg"),closeable:p,onViewReady:function(){u.oAuthLogin.bind(this.jq("#oauth"))}});
m.reg("LoginBox",c,p);return c});u.updateCount=function(){var c=[],e=H();if(e){g.each(e,function(i,l){c.push(i);l.rt&&c.push(l.rt.id)});c.length&&q.counts(c.join(","),function(i){if(i.isOk()){var l=i.getData();g.each(e,function(r,t){var v=l[r];if(v){var x=g("div.feed-list>ul>li[rel=w:"+r+"]");v[0]&&x.find("#cm").text("评论("+v[0]+")");v[1]&&x.find("#fw").text("转发("+v[1]+")");var C=t.rt;if(C&&(v=l[C.id])){x=x.find("div.forward");v[0]&&x.find("a[rel=l:cm]").each(function(){g(this).text(g(this).text()+
"("+v[0]+")")});v[1]&&x.find("a[rel=l:fw]").each(function(){g(this).text(g(this).text()+"("+v[1]+")")})}}});(i=u.updateCount.hooks)&&g.each(i,function(r,t){t(l)})}})}};u.updateCount.hooks=[];u.updateCount.addHook=function(c){g.isFunction(c)&&u.updateCount.hooks.push(c)};u.FadeShow=m.reg("FadeBox",w.create(j,{curr:0,length:0,duration:300,delay:5E3,running:false,runTimer:z,onViewReady:function(){this.$list=g(this.view).children();this.length=this.$list.length;var c=this;g(this.view).mouseover(function(){c.stop()}).mouseout(function(e){e=
e.relatedTarget;if(!e||!g.contains(c.view,e))c.start()});this.start()},start:function(){if(!(this.length<=1))if(!this.runTimer){var c=this;this.runTimer=setTimeout(function(){c.fade()},this.delay);this.running=p}},stop:function(){if(this.runTimer){clearTimeout(this.runTimer);this.runTimer=z}this.running=false},fade:function(){var c=this.curr,e=++this.curr,i=this;if(e>=this.length)this.curr=e=0;var l=g(this.$list[c]),r=g(this.$list[e]);l.animate({opacity:0},{duration:i.duration,complete:function(){l.addClass("next");
r.removeClass("next").css({opacity:0}).animate({opacity:1},{duration:i.duration,complete:function(){i.runTimer=z;i.running&&i.start()}})}})}}));u.FriendList=m.reg("FriendList",w.create(j,function(){return{onViewReady:function(){var c=this,e=g(this.view).children();g.each(e,function(i,l){g(l).mouseover(function(r){var t=c.onMouseOver;r=r.currentTarget;t&&t.call(r)}).mouseout(function(r){var t=c.onMouseOut,v=r.currentTarget;r=r.relatedTarget;if(!r||v===r||!g.contains(v,r))t&&t.call(v)})});return this}}}()));
m.reg("indexFocus",w.create(j,{actionMgr:p,onactiontrig:function(c){var e=c.data;switch(e.e){case "cls":g.cookie(c.get("cn"),1);this.display(0);break;case "do":c=e.op;if(c==1)(c=m.use("postArea"))&&c.selectionHolder.insertText("#"+e.tp+"# ");else c==2&&e.ln&&window.open(decodeURIComponent(e.ln.replace(/\+/g,"%20")))}}}));m.reg("MoreList",function(c){c=m.use("Layer",g.extend({closeable:p,contextable:p,actionMgr:p,onactiontrig:function(e){var i=e.data,l=e.get("u");switch(i.e){case "abl":s.confirm("提示",
"确定将"+i.nick+"加入到黑名单吗？<span>你和"+(i.gender=="f"?"她":"他")+"将自动解除关注关系，并且她不能再关注你，给你发评论、私信、@通知。</span>",function(r){r==="ok"&&q.blacklistAdd(l,"",function(t){t.isOk()&&window.location.reload()})})}}},c));m.reg("MoreList",c,p);return c});m.report=function(){function c(){var v=m.getCfg("uid");if(!v){v=g.cookie("x3w4b");if(!v){v=(v=void 0)||16;for(var x=["u"],C,E=0;E<v;E++){C=Math.ceil(Math.random()*62)-1;x.push("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".charAt(C))}v=x.join("");g.cookie("x3w4b",
v,{expires:9E4})}return v}return v}function e(v){r.random=Math.random();r.uid=c();r.akey=m.getCfg("akey");v=g.extend(r,v);var x=[];g.each(v,function(C,E){x.push(C+"="+encodeURIComponent(E))});l.src=i+"?"+x.join("&")}var i="http://beacon.x.weibo.com/a.gif",l,r={pjt:"xwb",ver:"1.1.1",xt:"stay"},t=function(){function v(){if(!C){c();l=new Image;C=p}}function x(){var M=(new Date).getTime();e({time:M-(F?F:E),p:m.getCfg("page")});F=M}var C=false,E=(new Date).getTime(),F=0;return{start:function(){v();window.setInterval(x,
18E5)},report:function(){!C&&v();x()}}}();return{start:function(){t.start()},report:function(){t.report()}}}();m.ax.AdMgm={init:function(c){c=this.cfgs=c||{};for(var e=!!this.globalHandlers,i=this.handlers,l=0,r=c.length;l<r;l++){var t=c[l];e&&this.fireGlobal(t);i&&i[t.flag]&&i[t.flag](t,this)}this.inited=true},fireGlobal:function(c){var e=this.globalHandlers;if(e)for(var i=0,l=e.length;i<l;i++)e[i](c,this)},reg:function(c,e){if(e===undefined)if(this.globalHandlers)this.globalHandlers.push(c);else this.globalHandlers=
[c];else{if(!this.handlers)this.handlers={};this.handlers[c]=e;this.inited&&this.cfgs[c]&&e(this.cfgs[c],this)}},getAd:function(c){if(!c)return this.cfgs;if(this.cfgs)for(var e=0;e<this.cfgs.length;e++)if(this.cfgs[e].flag==c)return this.cfgs[e]}}})(Xwb,jQuery);(function(m,g){var p=m.request,z=m.ui.MsgBox,u=m.getCfg,w=m.getWb;m.use("action").addFilter(function(h,j){if(!j||!j.na){var n=m.getUid(),q=m.getSiteUid(),s=u("loginCfg");if(!n){if(q)if(h.get("e")=="lg")m.ui.oAuthLogin.show("bind");else window.location=p.mkUrl("account","bind");else{if(h.get("t")=="sinaLogin")s=1;switch(s){case 3:m.use("LoginBox",{siteName:u("siteName")}).display(true);break;case 2:window.location=p.mkUrl("account","siteLogin");break;default:m.ui.oAuthLogin.show()}}return false}}},
true).reg("sd",function(h){var j=m.use("postBox"),n=h.get("m");j.display(true).reset().selectionHolder.setText(n||"");n&&j.checkText();if(h.data.format)j.htmlFormat=h.data.format}).reg("fw",function(h){h=h.get("w");Xwb.use("forwardBox").display(true).setContent(h,w(h),m.getUid()).selectionHolder.focusStart()}).reg("fl",function(h){var j=h.get("u");g(h.src);h.lock(1);p.follow(j,0,function(n){if(n.isOk()||n.getCode()=="1020805"){n=h.get("t");var q=g(h.src);switch(parseInt(n)){case 1:q.replaceWith('<span class="followed-btn">已关注</span>');
break;case 2:q.replaceWith("<em>已关注</em>");break;default:location.reload()}}else z.tipWarn(n.getMsg());h.lock(0)})}).reg("rs",function(h){var j=h.get("w");h=w(j);var n=Xwb.use("Box",{cs:"win-report",contentHtml:"SpanBoxContent",title:"举报不良信息",appendTo:document.body,closeable:true,autoCenter:true,mask:true,destroyOnClose:true,actionMgr:true,nick:h.u.sn,img:h.u.p,text:h.tx,onactiontrig:function(q){switch(q.data.e){case "ok":q=this.jq("#content").val();p.reportSpam(j,q,function(s){s.isOk()&&z.success("",
"您的举报已提交，我们将尽快处理，感谢您对我们工作的支持！");n.close()});break;case "cancel":this.close()}}});n.display(true).center();n.jq("#content").focus()}).reg("ufl",function(h){z.anchorConfirm(h.src,"确定要取消关注？",function(j){if(j=="ok"){h.lock(1);j=h.get("u");var n=h.get("f");p.unfollow(j,"",function(q){if(q.isOk())n==1?g(h.src).replaceWith('<a rel="e:fl,t:2" href="#">关注他</a>'):window.location.reload();else z.tipWarn(q.getMsg());h.lock(0)})}})}).reg("blm",function(h){z.anchorConfirm(h.src,"确定要屏蔽该微博？",function(j){if(j=="ok"){j=
h.get("w");h.lock(1);p.shieldBlog(j,function(n){if(n.isOk()){z.anchorTipOk(h.src,"屏蔽成功！");g(h.src).replaceWith("<span>已屏蔽</span>")}h.lock(0)})}})}).reg("rl",function(){location.reload()},{na:true}).reg("fr",function(h){var j=h.get("w");h.lock(1);p.fav(j,function(n){if(n.isOk()){z.anchorTipOk(h.src,"收藏成功！");g(h.src).replaceWith("<span>已收藏</span>")}else z.tipWarn(n.getMsg());h.lock(0)})}).reg("ufr",function(h){z.anchorConfirm(h.src,"确定要删除该收藏？",function(j){if(j=="ok"){h.lock(1);j=h.get("w");p.delFav(j,
function(n){if(n.isOk())if(u("page")=="fav"){var q=g(h.getEl("w"));q.slideUp(500,function(){q.remove();h.lock(0)})}else{g(h.src).replaceWith('<a rel="e:fr" href="#">收藏</a>');h.lock(0)}})}})}).reg("cm",function(h){var j=h.get("w"),n=g(h.getEl("w")),q=n.data("xwb_cmt");if(!q){var s=w(j);q=m.use("CmtArea",{wbId:j,wbUid:s&&s.u.id,appendTo:n.find(".feed-content"),trigEl:h.src});n.data("xwb_cmt",q)}if(q.display())q.display(false);else{q.display(true);q.load(function(){q.cmtBox.jqInputor.focus()})}}).reg("tl",
function(h){var j=g(h.getEl("w")),n=j.data("wbEle");if(!n){h=h.get("w");n=m.use("WbElement",{$wb:j,wbData:w(h)});j.data("wbEle",n)}n.trun("left")},{na:true}).reg("tr",function(h){var j=g(h.getEl("w")),n=j.data("wbEle");if(!n){h=h.get("w");n=m.use("WbElement",{$wb:j,wbData:w(h)});j.data("wbEle",n)}n.trun("right")},{na:true}).reg("zo",function(h){var j=g(h.getEl("w")),n=j.data("wbEle");if(!n){h=h.get("w");n=m.use("WbElement",{$wb:j,wbData:w(h)});j.data("wbEle",n)}n.zoomOut()},{na:true}).reg("zi",function(h){var j=
g(h.getEl("w")),n=j.data("wbEle");if(!n){h=h.get("w");n=m.use("WbElement",{$wb:j,wbData:w(h)});j.data("wbEle",n)}n.zoomIn()},{na:true}).reg("pv",function(h){var j=g(h.getEl("w")),n=j.data("wbEle");if(!n){n=h.get("w");n=m.use("WbElement",{$wb:j,wbData:w(n)});j.data("wbEle",n)}n.playVideo(h)},{na:true}).reg("cv",function(h){var j=g(h.getEl("w")),n=j.data("wbEle");if(!n){n=h.get("w");n=m.use("WbElement",{$wb:j,wbData:w(n)});j.data("wbEle",n)}n.closeVideo(h)},{na:true}).reg("dl",function(h){var j=h.get("w");
z.anchorConfirm(h.src,"确定删除该微博吗？",function(n){if(n==="ok"){h.lock(1);p.del(j,function(q){var s=g(h.getEl("w"));q.isOk()?s.slideUp("normal",function(){s.remove();var B=g("#user-weibo-count");if(B.length){var y=B.text().match(/\d+/g);B.text(y-1)}}):z.tipWarn(q.getMsg());h.lock(0)})}})}).reg("mop",function(h){h=g(h.src);var j=h.data("morelayer");if(!j){j=m.use("MoreList",{view:g("#more_list")[0]});h.data("morelayer",j)}j.display(1)}).reg("sdm",function(h){var j=m.use("myMsg");j.display(true).reset();
var n=h.get("c");n&&j.selectionHolder.setText(n);(h=h.get("n"))&&j.jqSender.val(h);h?j.jqContent.focus():j.jqSender.focus()}).reg("rm",function(h){m.use("myMsg").reply(h.get("u"),h.get("n"))}).reg("dm",function(h){z.anchorConfirm(h.src,"确定要删除该私信？",function(j){if(j=="ok"){h.lock(1);j=h.get("m");p.delMsg(j,function(n){n.isOk()&&location.reload();h.lock(0)})}})}).reg("dbl",function(h){function j(){h.lock(1);var q=h.get("u");p.blacklistDel(q,"",function(s){s.isOk()?location.reload():z.tipWarn(s.getMsg());
h.lock(0)})}var n=h.data.m;n?z.confirm("提示",n,function(q){q==="ok"&&j()}):j()})})(Xwb,$);(function(m,g){function p(w){var h=w.flag,j=w.page;g("#ad_"+h).find("#xwb_ad_cls").mousedown(function(){g("#ad_"+h).cssDisplay(false);g.cookie("ad_"+j+"_"+h+"_hide","1",{expires:1});return false})}function z(){if(!u){var w=g("#container"),h=g("#ad_global_left"),j=g("#ad_global_right"),n=function(){var q=w.offset().left;h.length&&h.css("left",q-h.width()-20);j.length&&j.css("left",q+w.width()+20)};g(window).resize(n);u=true;setTimeout(function(){h.css("visibility","hidden").removeClass("hidden");j.css("visibility",
"hidden").removeClass("hidden");n();h.css("visibility","");j.css("visibility","")},20)}}var u;m.ax.AdMgm.reg(function(w){p(w)});m.ax.AdMgm.handlers=g.extend(m.ax.AdMgm.handlers,{global_left:z,global_right:z})})(Xwb,$);$(function(){(function(m,g){g("#logo").length&&g("#logo").fixPng();var p=m.ui,z=m.cfg,u=m.request,w=m.getCfg,h=w("basePath"),j=w("page");m.use("action").bind(document.body);h&&u.init(h);if(m.getUid()){u=w("remind");m.use("notice",{appendTo:u?document.body:g("#xwbInnerNav")[0],remindType:u,latestWid:w("maxid")})}g("#publish_box").each(function(){var q=m.reg("postArea",m.use("base",{view:this}));g.extend(q,p.PostBase);q.initEx();q.display(true)});g("#xwb_weibo_list").each(function(){m.reg("weiboList",
m.use("WeiboList",{view:this})).display(true)});g("#xwb_search_form").each(function(){m.use("SearchEntry",{view:this}).display(true)});switch(j){case "":case "index":m.getUid()&&location.href.indexOf("skinset")>=0&&m.use("skin",{view:g("#xwbSkinSet")[0],tab:{selectedCS:"current",items:g("#tabItems>span"),contents:g("#tabPanels>div")}}).display(true);break;case "index.messages":g("#messageList li").hover(function(){g(this).find("#del").cssDisplay(true)},function(){g(this).find("#del").cssDisplay(false)});
break;case "show":u=g("#xwb_cmt_list");var n=u.attr("wbid");u=m.use("MBlogCmtArea",{view:u[0],wbId:n,wbUid:z.wbList&&z.wbList[n].u.id,topCmtBox:g("#topCmtBox")[0],faceSize:50});u.display(true).load();u.topCmtBox.jqInputor.focus();break;case "index.comments":case "index.commentsend":u=g("#xwb_cmt_list");m.use("MyCmt",{view:u[0]}).display(true)}switch(j){case "follow":g("#user_list").each(function(){m.use("FriendList",{view:this,onMouseOver:function(){g(this).find("a.forjs-cancel-att").show()},onMouseOut:function(){g(this).find("a.forjs-cancel-att").hide()}}).getView();
g(this).click(function(q){var s=g(q.target);if(!s.data("loading")&&s.hasClass("forjs-cancel-att")){var B=s.closest("LI");q=B.find("div.user-pic img").attr("title");var y=m.ui.MsgBox;y.confirm("提示","确定要取消关注"+q+"?",function(H){if(H==="ok"){s.data("loading",1);m.request.unfollow(s.attr("rel"),"",function(J){J.isOk()?B.slideUp(500,function(){B.remove()}):y.tipWarn(J.getMsg())})}})}})});break;case "fans":g("#user_list").each(function(){m.use("FriendList",{view:this,onMouseOver:function(){g(this).find("#removeFans,#sendMsg").removeClass("hidden")},
onMouseOut:function(){g(this).find("#removeFans,#sendMsg").addClass("hidden")}}).getView();g(this).click(function(q){var s=g(q.target);if(!s.data("loading")&&s.hasClass("forjs-cancel-att")){var B=s.closest("LI");q=B.find("div.user-pic img").attr("title");var y=m.ui.MsgBox;y.confirm("提示","移除之后将取消"+q+"对你的关注?",function(H){if(H==="ok"){s.data("loading",1);m.request.removeFans(s.attr("rel"),"",function(J){J.isOk()?B.slideUp(500,function(){B.remove()}):y.tipWarn(J.getMsg())})}})}})});break;case "search":case "search.weibo":case "search.user":j=
j=="search.user"?g("div.user-list"):g("div.feed-list");j=j.add(g("div.fame-list"));j.length&&j.highlight(g("#k").val());case "search.recommend":!location.hash&&g("#k").focus();if(g.browser.msie)(j=document.getElementById("k"))&&m.util.focusEnd(j);g("#searchForm").bind("submit",function(){if(!g.trim(g("#k").val())){g("#searchTip").cssDisplay(true);g("#k").focus();return false}});g("#searchBtn").click(function(){if(m.util.byteCut(g.trim(g("#k").val()),30))g("#searchForm").submit();else{g("#searchTip").cssDisplay(true);
g("#k").focus()}return false});break;case "pub":g("#win_city").each(function(){var q=this,s=m.use("Layer",{closeable:true,contextable:true,provinces:null,view:q,onViewReady:function(){m.request.getProvinces(m.util.bind(this.onDataLoaded,this));var B=this;this.jq("#citys").click(function(y){y.target.tagName=="A"&&B.close()})},onDataLoaded:function(B){if(B.isOk()){this.provinces=B.getData().provinces;var y=this;this.jq("#sel-area").change(function(){y.changeProvince(this.value)})}},changeProvince:function(B){if(this.provinces){var y=
this;g.each(this.provinces,function(H,J){if(J.id==B){var c=[];g.each(J.citys,function(e,i){var l,r;for(e in i){l=e;r=i[e]}c.push('<a href="'+(h+"index.php?m=pub&province="+B+"&city="+l+"#city")+'">'+r+"</a>")});y.jq("#citys").html(c.join(""));return false}})}}});g("#cityBtn").click(function(){s.display(g(q).hasClass("hidden"));return false})})}p.linkRender();g("#hot_mblog div.feed-list").each(function(q){p.updateCount.addHook(function(s,B){return function(y){s.find("#xwb_weibo_list_ct>li").each(function(){var H=
g(this),J=H.attr("rel").split(":")[1];(J=y[J])&&H.find("strong").text(J[B?0:1])})}}(g(this),q))});z&&z.wbList&&p.updateCount();g("#xwb_today_topic").each(function(){g(this).find("p.feedback").substrText(80,1);g(this).find("div.column-item:first").removeClass("next");m.use("FadeBox",{view:this}).display(1)});g("#hot_mblog").each(function(){var q=g(this);m.use("Switcher",{items:q.find("div.tab-s2>span"),contents:q.find("div.hot-mblog-body"),trigMode:"click",selectedCS:"current"})});m.report.start();
g(window).bind("unload",function(){m.report.report()});w("ads")&&m.ax.AdMgm.init(w("ads"))})(Xwb,$)});(function(m,g){Xwb.ax.Validator.prototype.reg("ne",function(p,z,u,w){var h=z==="";if(!h&&u.w)(h=z==u.w)&&this.setValue("");if(h&&!u.m)u.m="该项不能为空";if(p.tagName==="INPUT"&&(p.type==="radio"||p.type==="checkbox"))h=p.checked;this.report(!h,u);w()}).reg("f",function(p){var z=this;g(p).blur(function(){z.validElement(this)})}).reg("sz",function(p,z,u,w){p=u.ww?Xwb.util.byteLen(z):z.length;var h;z=u.max;var j=u.min;if(z!==undefined&&parseInt(z)<p)h=true;if(j!==undefined&&parseInt(j)>p)h=true;this.report(!h,
u);w()}).reg("dt",function(p,z,u,w){if(!u.m)u.m="不是有效的日期格式";p=Date.parse(z);this.report(!isNaN(p),u);w()}).reg("mail",function(p,z,u,w){p=z&&/\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*/.test(z);if(!u.m&&u.m!==0)u.m="请输入正确的邮箱格式";this.report(!z||p,u);w()}).reg("int",function(p,z,u,w){this.report(z&&/^\d+$/.test(z),u);w()}).reg("bt",function(p,z,u,w){p=parseInt(u.min);var h=parseInt(u.max);z=parseInt(z);var j=0;if(z<p)j=1;if(!j&&z>h)j=2;this.report(!j,u);w()}).reg("sinan",function(p,z,u,w){if(!u.m)u.m=
'支持中英文、数字、"_"或减号';this.report(/^[a-zA-Z0-9\u4e00-\u9fa5_-]+$/.test(z),u);w()})})(Xwb,$);
